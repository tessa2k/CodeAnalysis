=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_outputUS2.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm

	addmsg /cell/tertdend1_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend5_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend9_1/fluorescence /output/plot_out SAVE ratio

	addmsg /cell/tertdend1_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_1/volavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_1/NR2A/GHK /output/plot_out SAVE Ik
	addmsg /cell/tertdend1_1/NR2A/block /output/plot_out SAVE Ik
	addmsg /cell/tertdend5_1/NR2A/GHK /output/plot_out SAVE Ik
	addmsg /cell/tertdend5_1/NR2A/block /output/plot_out SAVE Ik
	addmsg /cell/tertdend9_1/NR2A/GHK /output/plot_out SAVE Ik
	addmsg /cell/tertdend9_1/NR2A/block /output/plot_out SAVE Ik

	addmsg /cell/tertdend1_1/NR2A/GHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/NR2A/block /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/NR2A/GHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/NR2A/block /output/plot_out SAVE Gk
	addmsg /cell/tertdend9_1/NR2A/GHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend9_1/NR2A/block /output/plot_out SAVE Gk


	addmsg /cell/tertdend1_1/CaL12_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/CaL12_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend9_1/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend9_1/CaL13_channelGHK /output/plot_out SAVE Gk



=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/upstateAPstimGABA.g ===


//set random seed so for each simulation the randomspike train will be the same
randseed 2394075

//3 = 5757538
//5 = 9824501
//4 = 2394075

/****************begin local subroutines*************/
function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	//addmsg /cell/soma/KIR_channel /output/plot_out SAVE Gk
	//addmsg /cell/soma/Ca_difshell_1 /output/plot_out  SAVE C
	//addmsg /cell/soma/Ca_difshell_2 /output/plot_out  SAVE C
	//addmsg /cell/soma/Ca_difshell_4 /output/plot_out  SAVE C
	//addmsg /cell/soma/Ca_difshell_5 /output/plot_out  SAVE C
	//addmsg /cell/soma/BKK_channel /output/plot_out  SAVE Ik
	//addmsg /cell/soma/SK_channel /output/plot_out  SAVE Ik
	
	addmsg /cell/soma/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/primdend1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/secdend11/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend1_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend1_2/fluorescence /output/plot_out SAVE ratio

	addmsg /cell/primdend2/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/secdend21/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend2_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend2_2/fluorescence /output/plot_out SAVE ratio

	addmsg /cell/primdend3/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/secdend31/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend3_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend3_2/fluorescence /output/plot_out SAVE ratio



=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/Store_Parameters.g ===
//genesis

//this is a function to create a file will all the important parameters for each simulation
//things like Mg concentration, CDI parameters, Fura parameters, NMDA parameters etc.


function Store_Parameters
	print "calciumdye=" {calciumdye}
	print "calciumtype=" {calciumtype}
	print "calciuminact=" {calciuminact}
	print "NMDAbuffermode=" {NMDAbuffermode}
	if (calciumdye == 1)
		print "Furaconc=" {btotal3} 
		print "FuraKf=" {Kf3}
		print "FuraKb=" {Kb3}
	elif (calciumdye == 2)
		print "Fluo5Fconc=" {btotal5}
		print "Fluo5FKf=" {Kf5}
		print "Fluo5FKb=" {Kb5}
	end
	print "AMPAdes=" {AMPAdes}
	print "AMPAdestau=" {AMPAdestau}
	print "NMDAdes=" {NMDAdes}
	print "NMDAdestau=" {NMDAdestau}
	print "NMDAfracCa=" {NMDAperCa}
	print "nmdaKMg=" {KMg}
	print "nmdaGamma=" {gamma}
	print "Mgconc=" {CMg}


	
end


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US20noAPSTDP.g ===



str cellpath = "/cell"
str othercell = "/othercell"


include RebekahSims/SpikeMakerSTDP.g
include RebekahSims/add_outputgradSTDP




create compartment {othercell}
addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_2/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_3/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_4/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_5/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_6/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_7/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_8/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_9/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_10/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_11/spikegen INPUT Vm

addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend2_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend3_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend4_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend5_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend6_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend7_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend8_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend9_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend10_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend11_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend12_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend13_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend14_1/spikegen INPUT Vm


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_outputgrad4.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	addmsg /cell/tertdend1_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend5_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend9_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend13_1 /output/plot_out SAVE Vm

	addmsg /cell/tertdend1_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_1/volavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_1/Ca_difshell_1CaMN /output/plot_out SAVE Bbound
	addmsg /cell/tertdend5_1/Ca_difshell_1CaMN /output/plot_out SAVE Bbound
	addmsg /cell/tertdend9_1/Ca_difshell_1CaMN /output/plot_out SAVE Bbound
	addmsg /cell/tertdend13_1/Ca_difshell_1CaMN /output/plot_out SAVE Bbound

	addmsg /cell/tertdend1_1/Ca_difshell_1CaMC /output/plot_out SAVE Bbound
	addmsg /cell/tertdend5_1/Ca_difshell_1CaMC /output/plot_out SAVE Bbound
	addmsg /cell/tertdend9_1/Ca_difshell_1CaMC /output/plot_out SAVE Bbound
	addmsg /cell/tertdend13_1/Ca_difshell_1CaMC /output/plot_out SAVE Bbound

	addmsg /cell/tertdend1_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend5_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend9_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend13_1/NMDApool /output/plot_out SAVE Ca
	
	addmsg /cell/tertdend1_1/Lpool /output/plot_out SAVE Ca
	addmsg /cell/tertdend5_1/Lpool /output/plot_out SAVE Ca
	addmsg /cell/tertdend9_1/Lpool /output/plot_out SAVE Ca
	addmsg /cell/tertdend13_1/Lpool /output/plot_out SAVE Ca
	

/*


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/Shindou3APpre-post.g ===
//genesis Shindou3AP.g

include RebekahSims/addoutput.g
str cellpath = "/cell"
add_output

str stimtype = "Shindou3APpre-post"
diskpath={diskpath}@(stimtype)@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

setfield /output/plot_out filename output/{diskpath}
		call /output/plot_out OUT_OPEN
		call /output/plot_out OUT_WRITE "time SomaVm somaVavg primVavg secVavg tertVavg" //header


step 0.1 -time

	setfield {cellpath}/tertdend1_1/presyn_ext z {1/{getclock 0}}
	
step 1

	setfield {cellpath}/tertdend1_1/presyn_ext z 0

step 0.01 -time
//Shindou uses 100Hz triplets
	
	step 0 -time	
	setfield {cellpath}/soma inject 1e-9 
	step 0.005 -time
	setfield {cellpath}/soma inject 0
	step 0.005 -time
	setfield {cellpath}/soma inject 1e-9 
	step 0.005 -time
	setfield {cellpath}/soma inject 0
	step 0.005 -time
	setfield {cellpath}/soma inject 1e-9 
	step 0.005 -time
	setfield {cellpath}/soma inject 0


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US175.g ===


add_output

float inj = 800e-12
int Hz = 10  //for glu, function incrases by 2.5 this for GABA
float upstate_time = 0.3
float AP_time = 0.175  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms


str stimtype = "AP175flat"
str diskpath={diskpath1}@(stimtype)@{spiketypeFlat}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

	makeallpreFlat {Hz}

step 0.05 -time

	makeallpostFlat

step {AP_time} -time
	
	setfield {cellpath}/soma inject {inj}

step {AP_durtime} -time

	setfield {cellpath}/soma inject 0
	
step {{upstate_time}-{AP_time}-{AP_durtime}} -time

	StopAllFlat

step 0.2 -t




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/theta.g ===
//genesis theta.g


include RebekahSims/addoutput.g
str cellpath = "/cell"
add_output

str stimtype = "ThetaLong"
diskpath={diskpath}@(stimtype)@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

setfield /output/plot_out filename output/{diskpath}
		call /output/plot_out OUT_OPEN
		call /output/plot_out OUT_WRITE "time SomaVm somaVavg primVavg secVavg tertVavg" //header

float trainHz = 10.5
float burstHz = 50
int i
int j

step 0.1 -time

for (j=0; j<10; j=j+1)
	step 14.845 -time
	for (i=0; i<10; i=i+1)
		
		setfield {cellpath}/tertdend1_1/presyn_ext z {1/{getclock 0}}
		step 1
		setfield {cellpath}/tertdend1_1/presyn_ext z 0
	
		step 0.02 -time

		setfield {cellpath}/tertdend1_1/presyn_ext z {1/{getclock 0}}
		step 1
		setfield {cellpath}/tertdend1_1/presyn_ext z 0

		step 0.02 -time



=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/ifFURA.g ===
//genesis
//IF2.g

function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	//addmsg /cell/soma/NaF_channel /output/plot_out  SAVE Gk
/*
	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KAf_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KDR_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KAs_channel /output/plot_out  SAVE Gk

	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Gk

	addmsg /cell/soma/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/secdend11/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL12_channelGHK /output/plot_out SAVE Gk
		
*/
	addmsg /cell/soma/fluorescence /output/plot_out SAVE ratio


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/SingleBlast.g ===
//genesis SingleBlast.g

include RebekahSims/add_outputgrad3.g

add_output
str cellpath = "/cell"
str othercell = "/othercell"
str stimtype = "SingleBlastlong"
diskpath={diskpath}@(stimtype)@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

setfield /output/plot_out filename output/{diskpath}
		call /output/plot_out OUT_OPEN
		call /output/plot_out OUT_WRITE "time SomaVm tert1Vm tert1Fluo5F tert1Vavg tert1NMDACa tert1LCa tert1NMDAGHKgk tert1NMDAblockgk tert1L12X tert1L12Y tert1L12Z tert1L13X tert1L13Y tert1L13Z tert1RX tert1RY tert1RZ" //header	

//because we are using the facsynchan which cannot recieve activation messages, we have to use spikegen 
//objects and send input into them.
 
	create compartment {othercell}
	str CompName
	foreach CompName ({el /cell/##[TYPE=compartment]})
		addmsg {othercell} {CompName}/spikegen INPUT Vm
	end

float deltaT = 0.01
float AP_durtime = 0.005
int i
setfield /data/soma overlay 1
setfield /data/spineVm overlay 1
setfield /data/spineCa overlay 1
setfield /data/Ca overlay 1

for (i=0; i<15; i=i+1)
		call /output/plot_out OUT_WRITE "/newplot" 
		call /output/plot_out OUT_WRITE "/plotname "{deltaT} 
	step 0.1 -time




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_outputBuffers.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	
	addmsg /cell/tertdend1_1/volavg /output/plot_out SAVE meanValue 
	addmsg /cell/tertdend5_1/volavg /output/plot_out SAVE meanValue 
	addmsg /cell/tertdend9_1/volavg /output/plot_out SAVE meanValue 
	addmsg /cell/tertdend13_1/volavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_1/Ca_difshell_1CaMN /output/plot_out SAVE Bbound
	addmsg /cell/tertdend5_1/Ca_difshell_1CaMN /output/plot_out SAVE Bbound
	addmsg /cell/tertdend9_1/Ca_difshell_1CaMN /output/plot_out SAVE Bbound
	addmsg /cell/tertdend13_1/Ca_difshell_1CaMN /output/plot_out SAVE Bbound

	addmsg /cell/tertdend1_1/Ca_difshell_1CaMC /output/plot_out SAVE Bbound
	addmsg /cell/tertdend5_1/Ca_difshell_1CaMC /output/plot_out SAVE Bbound
	addmsg /cell/tertdend9_1/Ca_difshell_1CaMC /output/plot_out SAVE Bbound
	addmsg /cell/tertdend13_1/Ca_difshell_1CaMC /output/plot_out SAVE Bbound

	addmsg /cell/tertdend1_1/Ca_difshell_1calbindin /output/plot_out SAVE Bbound
	addmsg /cell/tertdend5_1/Ca_difshell_1calbindin /output/plot_out SAVE Bbound
	addmsg /cell/tertdend9_1/Ca_difshell_1calbindin /output/plot_out SAVE Bbound
	addmsg /cell/tertdend13_1/Ca_difshell_1calbindin /output/plot_out SAVE Bbound

end

/* copy into file: 
call /output/plot_out OUT_OPEN
call /output/plot_out OUT_WRITE "time SomaVm tert1volavg tert5volavg tert9volavg tert13volavg tert1CaMN tert5CaMN tert9CaMN tert13CaMN tert1CaMC tert5CaMC tert9CaMC tert13CaMC tert1cb tert5cb tert9cb tert13cb" //header	
*/



=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US20grad.g ===


add_output
float inj = 800e-12
str stimtype = "20APgrad"
str diskpath={diskpath1}@(stimtype)@{spiketypeGrad}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

int Hz = 10 //for glu, function multiplies this by 2 for GABA
float upstate_time = 0.3
float AP_time = 0.02  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms
float high_time = 0.01
float med_time  = 0.2
float low_time  = 0.09

// use randomspike to put inputs into NMDA and AMPA receptors 

makeALLpreGrad {Hz}


step 0.05 -time

makeALLpostGrad "high"

	step {high_time} -time

stopGluGrad
stopGABAGrad
makeALLpostGrad "med"

	step {{AP_time}-{high_time}} -time

		setfield {cellpath}/soma inject {inj}

	step {AP_durtime} -time


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US100.g ===


add_output

float inj = 800e-12
int Hz = 10  //for glu, function incrases by 2.5 this for GABA
float upstate_time = 0.3
float AP_time = 0.1  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms


str stimtype = "AP100flat"
str diskpath={diskpath1}@(stimtype)@{spiketypeFlat}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

	makeallpreFlat {Hz}

step 0.05 -time

	makeallpostFlat

step {AP_time} -time
	
	setfield {cellpath}/soma inject {inj}

step {AP_durtime} -time

	setfield {cellpath}/soma inject 0
	
step {{upstate_time}-{AP_time}-{AP_durtime}} -time

	StopAllFlat

step 0.2 -t




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/SpontAPgrad.g ===

str cellpath = "/cell"


include RebekahSims/SpikeMaker.g
include RebekahSims/add_outputgrad2.g

add_output

float inj = 800e-12
str stimtype = "SpontAPgrad"
diskpath={diskpath}@(stimtype)@{spiketype}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

call /output/plot_out OUT_OPEN
call /output/plot_out OUT_WRITE "time SomaVm tert1Vm tert5Vm tert9Vm tert13Vm tert1Fura tert5Fura tert9Fura tert13Fura tert1_1GkSum tert1_1CaSum" //header	


int Hz = 10 //for glu, function multiplies this by 2 for GABA
float upstate_time = 0.3
float AP_time = 0  //AP latency from upstate onset
float AP_durtime = 0 //duration of AP depolarization at soma, 5 ms
float high_time = 0.01
float med_time  = 0.2
float low_time  = 0.09

// use randomspike to put inputs into NMDA and AMPA receptors 

makeALLpre {Hz}


step 0.05 -time

makeGLUpost "high"

step {high_time} -time
	
stopGlu


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US20gradSTDP.g ===



str cellpath = "/cell"
str othercell = "/othercell"


include RebekahSims/SpikeMakerSTDP.g
include RebekahSims/add_outputgradSTDP




create compartment {othercell}
addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_2/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_3/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_4/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_5/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_6/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_7/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_8/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_9/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_10/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_11/spikegen INPUT Vm

addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend2_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend3_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend4_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend5_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend6_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend7_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend8_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend9_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend10_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend11_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend12_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend13_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend14_1/spikegen INPUT Vm


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/SingleStim.g ===
//genesis SingleStim.g

include RebekahSims/addoutput.g
str cellpath = "/cell"
add_output

str stimtype = "Singletert"
diskpath={diskpath}@(stimtype)@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

setfield /output/plot_out filename output/{diskpath}
		call /output/plot_out OUT_OPEN
		call /output/plot_out OUT_WRITE "time SomaVm tert1_1volavg tert1_1Cadif1 tert1_1fura" //header


step 0.05 -time

	setfield {cellpath}/tertdend1_1/presyn_ext z {1/{getclock 0}}
	
step 1

	setfield {cellpath}/tertdend1_1/presyn_ext z 0

step 0.1 -time



=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/header.g ===


//header call from addoutput.g files

//addoutputBuffers.g

call /output/plot_out OUT_OPEN
call /output/plot_out OUT_WRITE "time SomaVm tert1volavg tert5volavg tert9volavg tert13volavg tert1CaMN tert5CaMN tert9CaMN tert13CaMN tert1CaMC tert5CaMC tert9CaMC tert13CaMC tert1cb tert5cb tert9cb tert13cb" //header	


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/if3.g ===
//genesis
//IF2.g

function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
/*
	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Gk
	addmsg /cell/secdend11/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/secdend11/SK_channel /output/plot_out  SAVE Gk

	
	addmsg /cell/soma/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/secdend11/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL12_channelGHK /output/plot_out SAVE Gk
		
	//addmsg /cell/soma/fluorescence /output/plot_out SAVE ratio
	//addmsg /cell/primdend1/fluorescence /output/plot_out SAVE ratio
	//addmsg /cell/secdend12/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend1_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend1_2/fluorescence /output/plot_out SAVE ratio



=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/addoutputX.g ===
//addoutput.g
	// function for saving parameter in ascii file.  
	//function is made and called in this file
	
//make function 

function sav_disk_asc(diskpath,srcpath,field)
    create asc_file /output/{diskpath}
    setfield /output/{diskpath}   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/{diskpath} 0
    setfield /output/{diskpath} filename output/{diskpath}
    addmsg {srcpath} /output/{diskpath}  SAVE {field}
    call /output/{diskpath} OUT_OPEN
    call /output/{diskpath} OUT_WRITE "time #1" //header
    echo {diskpath}
end
		
		
		
//call function
	
	/*******************save soma information****************************************************
		sav_disk_asc somaVm{subunit}{stimtype} {cellpath}/soma Vm
	*******************************************************************************************/
	
	/*******************save secondary dendrite parameters**************************************
		//sav_disk_asc dendCa{subunit}{stimtype} {cellpath}/secdend3/{CalciumBuffer_3} Ca  
		sav_disk_asc NMDACa{subunit}{stimtype} {cellpath}/secdend3/spine_1/head/buffer_NMDA Ca
		//sav_disk_asc spineCa{subunit}{stimtype} {cellpath}/secdend3/spine_1/head/SpineCa Ca
		//sav_disk_asc LspineCa{subunit}{stimtype} {cellpath}/secdend3/spine_1/head/SpineCaL Ca
		//sav_disk_asc Ikblock{subunit}{stimtype} {cellpath}/secdend3/spine_1/head/{subunit}/block Ik
		//sav_disk_asc spineVm{subunit}{stimtype} {cellpath}/secdend3/spine_1/head Vm
	*******************************************************************************************/
 
	/******************save tertiary dendrite information****************************************
		sav_disk_asc dendCa{subunit}{stimtype}3 {cellpath}/tertdend3/{CalciumBuffer_3} Ca
		sav_disk_asc spineCa{subunit}{stimtype}3 {cellpath}/tertdend3/tert_dend5/spine_1/head/buffer_NMDA
		sav_disk_asc Ikblock{subunit}{stimtype}3 {cellpath}/tertdend3/tert_dend5/spine_1/head/{subunit}/block Ik Ca
		sav_disk_asc spineVm{subunit}{stimtype}3 {cellpath}/tertdend3/tert_dend5/spine_1/head Vm


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US50gradSTDP.g ===



str cellpath = "/cell"
str othercell = "/othercell"


include RebekahSims/SpikeMakerSTDP.g
include RebekahSims/add_outputgradSTDP




create compartment {othercell}
addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_2/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_3/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_4/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_5/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_6/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_7/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_8/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_9/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_10/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_11/spikegen INPUT Vm

addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend2_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend3_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend4_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend5_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend6_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend7_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend8_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend9_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend10_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend11_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend12_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend13_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend14_1/spikegen INPUT Vm


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US100grad.g ===


add_output

float inj = 800e-12
str stimtype = "100APgrad"
str diskpath={diskpath1}@(stimtype)@{spiketypeGrad}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

int Hz = 10 //for glu, function multiplies this by 2 for GABA
float upstate_time = 0.3
float AP_time = 0.1  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms
float high_time = 0.01
float med_time  = 0.2
float low_time  = 0.09

// use randomspike to put inputs into NMDA and AMPA receptors 

makeALLpreGrad {Hz}


step 0.05 -time

makeALLpostGrad "high"

	step {high_time} -time

stopGluGrad
stopGABAGrad
makeALLpostGrad "med"

	step {{AP_time}-{high_time}} -time

		setfield {cellpath}/soma inject {inj}



=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US10.g ===


add_output

float inj = 800e-12
int Hz = 10  //for glu, function incrases by 2.5 this for GABA
float upstate_time = 0.3
float AP_time = 0.01  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms


str stimtype = "AP10flat"
str diskpath={diskpath1}@(stimtype)@{spiketypeFlat}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

	makeallpreFlat {Hz}

step 0.05 -time

	makeallpostFlat

step {AP_time} -time
	
	setfield {cellpath}/soma inject {inj}

step {AP_durtime} -time

	setfield {cellpath}/soma inject 0
	
step {{upstate_time}-{AP_time}-{AP_durtime}} -time

	StopAllFlat

step 0.2 -t




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/SpikeMakerSTDP.g ===


str spiketype = "spke4"

//1: high=*50, med =*1, low =/1.5, gaba = *2
//2: high=*40, med =*1, low =/1.5, gaba = *2
//3: high=*40, med =*1, low =/1.5, gaba = *3
//4: high=*40, med =*1, low =/1.5, gaba = *4
//5: high=*60, med =/2, low =/5, gaba = *4
//6: high=*30, med =*1, low =/1.5, gaba = *4


//****start local subroutines

function makeinputpre(rate, path)
    str rate
    str path
    create randomspike {path}/randomspikehigh
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*40} reset 1 reset_value 0	
    create randomspike {path}/randomspikemed
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}} reset 1 reset_value 0	
    create randomspike {path}/randomspikelow
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}/1.5} reset 1 reset_value 0	
    create randomspike {path}/randomspike2
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*4} reset 1 reset_value 0	
 end
	
function makeinputpost(pathspike, path) 
	str path
	int msgnum
	addmsg {pathspike} {path} SPIKE
    	msgnum = {getfield {path} nsynapses} - 1
   	setfield {path} \
  	synapse[{msgnum}].weight 1 synapse[{msgnum}].delay 0
end


function stopinput (path)
	str path
	deletemsg {path} 2 -incoming


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US175noAPSTDP.g ===



str cellpath = "/cell"
str othercell = "/othercell"


include RebekahSims/SpikeMakerSTDP.g
include RebekahSims/add_outputgradSTDP




create compartment {othercell}
addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_2/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_3/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_4/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_5/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_6/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_7/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_8/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_9/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_10/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_11/spikegen INPUT Vm

addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend2_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend3_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend4_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend5_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend6_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend7_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend8_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend9_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend10_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend11_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend12_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend13_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend14_1/spikegen INPUT Vm


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/upstateAPstim.g ===


//set random seed so for each simulation the randomspike train will be the same
randseed 5757538
//2 = 9824501
//1 = 2394075

include RebekahSims/addoutput.g

/****************begin local subroutines*************/

//these three functions used to provide synaptic input to neuron

function makeinputpre(rate, path)
    str rate
    str path
    create randomspike {path}/randomspike
    setfield ^ min_amp 1.0 max_amp 1.0 rate {rate} reset 1 reset_value 0	
    create randomspike {path}/randomspike2
    setfield ^ min_amp 1.0 max_amp 1.0 rate {rate+1} reset 1 reset_value 0
    create randomspike {path}/randomspike3
    setfield ^ min_amp 1.0 max_amp 1.0 rate {rate-1} reset 1 reset_value 0
 
end
	
function makeinputpost(pathspike, path) 
	str path
	int msgnum
	addmsg {pathspike} {path} SPIKE
    	msgnum = {getfield {path} nsynapses} - 1
   	 setfield {path} \
   	 synapse[{msgnum}].weight 1 synapse[{msgnum}].delay 0
end


function stopinput(path)
	str path
	deletemsg {path} 2 -incoming
end



=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_outputgradSTDP.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
		
	addmsg /cell/tertdend1_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_1/Fluo5FVavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_2/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend1_3/Fluo5FVavg /output/plot_out SAVE meanValue
	
	addmsg /cell/tertdend1_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend1_1/Lpool /output/plot_out SAVE Ca
	addmsg /cell/tertdend5_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend5_1/Lpool /output/plot_out SAVE Ca
	addmsg /cell/tertdend1_2/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend1_2/Lpool /output/plot_out SAVE Ca

end

/* copy into file: 
call /output/plot_out OUT_OPEN
call /output/plot_out OUT_WRITE "time SomaVm tert1_1F5F tert5_1F5F tert9_1F5F tert13_1F5F tert1_2F5F tert1_3F5F tert1_1NMDACa tert1_1LCa tert5_1NMDACa tert5_1LCa tert1_2NMDACa tert1_2LCa" //header	
*/




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/iv.g ===

//IF.g

//str srcpath={neuronname}@"/soma"
//str savefield="Vm"
//float outputclock = 2e-5
//create asc_file /output/plot_out

//useclock /output/plot_out 1
//setfield /output/plot_out   flush 1  leave_open 1 append 1 \
//          float_format %0.6g

 function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	call /output/plot_out OUT_OPEN
	call /output/plot_out OUT_WRITE "time SomaVm" //header
end

add_output
str diskpath
str subunit
str stimtype
echo "diskpath" 
reset

	stimtype="IVcurve"
	diskpath=(subunit)@(stimtype)@".txt"
	setfield /output/plot_out filename output/{diskpath}
		call /output/plot_out OUT_OPEN
		call /output/plot_out OUT_WRITE "time	somaVm" 
	

//setfield /data/soma overlay 1
int i = 0
float inj =  -500e-12  //990e-12  //640e-12  //280e-12   



=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/upstateAPstim1.g ===


//set random seed so for each simulation the randomspike train will be the same
randseed 5757538
//2 = 9824501
//1 = 2394075

/****************begin local subroutines*************/
function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	//addmsg /cell/soma/KIR_channel /output/plot_out SAVE Gk
	//addmsg /cell/soma/Ca_difshell_1 /output/plot_out  SAVE C
	//addmsg /cell/soma/Ca_difshell_2 /output/plot_out  SAVE C
	//addmsg /cell/soma/Ca_difshell_4 /output/plot_out  SAVE C
	//addmsg /cell/soma/Ca_difshell_5 /output/plot_out  SAVE C
	//addmsg /cell/soma/BKK_channel /output/plot_out  SAVE Ik
	//addmsg /cell/soma/SK_channel /output/plot_out  SAVE Ik
	
	addmsg /cell/soma/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/primdend1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/secdend11/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend1_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend1_2/fluorescence /output/plot_out SAVE ratio

	addmsg /cell/primdend2/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/secdend21/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend2_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend2_2/fluorescence /output/plot_out SAVE ratio

	addmsg /cell/primdend3/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/secdend31/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend3_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend3_2/fluorescence /output/plot_out SAVE ratio


	//addmsg /cell/tertdend1/tert_dend3/fluorescence /output/plot_out SAVE ratio


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US50.g ===


add_output

float inj = 800e-12
int Hz = 10  //for glu, function incrases by 2.5 this for GABA
float upstate_time = 0.3
float AP_time = 0.05  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms


str stimtype = "AP50flat"
str diskpath={diskpath1}@(stimtype)@{spiketypeFlat}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

	makeallpreFlat {Hz}

step 0.05 -time

	makeallpostFlat

step {AP_time} -time
	
	setfield {cellpath}/soma inject {inj}

step {AP_durtime} -time

	setfield {cellpath}/soma inject 0
	
step {{upstate_time}-{AP_time}-{AP_durtime}} -time

	StopAllFlat

step 0.2 -t




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_output5.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	
	addmsg /cell/primdend1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/primdend2/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/primdend3/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/primdend4/Fluo5FVavg /output/plot_out SAVE meanValue

	addmsg /cell/secdend11/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/secdend21/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/secdend31/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/secdend41/Fluo5FVavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_1/Fluo5FVavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_2/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_2/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_2/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_2/Fluo5FVavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_3/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_3/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_3/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_3/Fluo5FVavg /output/plot_out SAVE meanValue

end

/* copy into file: 
call /output/plot_out OUT_OPEN
call /output/plot_out OUT_WRITE "time SomaVm prim1F5F prim2F5F prim3F5F prim4F5F sec11F5F sec21F5F sec31F5F sec41F5f tert1_1F5F tert5_1F5F tert9_1F5F tert13_1F5F tert1_2F5F tert5_2F5F tert9_2F5F tert13_2F5F tert1_3F5F tert5_3F5F tert9_3F5F tert13_3F5F" //header	
*/


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_outputgrad3.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	addmsg /cell/tertdend1_1 /output/plot_out SAVE Vm

	addmsg /cell/tertdend1_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend1_1/volavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend1_1/Lpool /output/plot_out SAVE Ca

	addmsg /cell/tertdend1_1/NR2A/GHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/NR2A/block /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaL12_channel /output/plot_out SAVE X 
	addmsg /cell/tertdend1_1/CaL12_channel /output/plot_out SAVE Y
	addmsg /cell/tertdend1_1/CaL12_channel /output/plot_out SAVE Z

	addmsg /cell/tertdend1_1/CaL13_channel /output/plot_out SAVE X 
	addmsg /cell/tertdend1_1/CaL13_channel /output/plot_out SAVE Y
	addmsg /cell/tertdend1_1/CaL13_channel /output/plot_out SAVE Z
	
	addmsg /cell/tertdend1_1/CaR_channel /output/plot_out SAVE X 
	addmsg /cell/tertdend1_1/CaR_channel /output/plot_out SAVE Y
	addmsg /cell/tertdend1_1/CaR_channel /output/plot_out SAVE Z

end

/* copy into file: 
call /output/plot_out OUT_OPEN
call /output/plot_out OUT_WRITE "time SomaVm tert1Vm tert1Fluo5F tert1Vavg tert1NMDACa tert1LCa tert1NMDAGHKgk tert1NMDAblockgk tert1L12X tert1L12Y tert1L12Z tert1L13X tert1L13Y tert1L13Z tert1RX tert1RY tert1RZ" //header	
*/




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_outputgrad.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	addmsg /cell/tertdend1_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend5_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend9_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend13_1 /output/plot_out SAVE Vm

	addmsg /cell/tertdend1_1/Fluo5F /output/plot_out SAVE ratio
	addmsg /cell/tertdend5_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend9_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend13_1/fluorescence /output/plot_out SAVE ratio

	addmsg /cell/tertdend1_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend5_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend9_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend13_1/fluorescence /output/plot_out SAVE ratio

	addmsg /cell/tertdend1_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_1/volavg /output/plot_out SAVE meanValue
/*
	addmsg /cell/tertdend1_1/NR2A/GHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/NR2A/block /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/NR2A/GHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/NR2A/block /output/plot_out SAVE Gk
	addmsg /cell/tertdend9_1/NR2A/GHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend9_1/NR2A/block /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaL12_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/CaL12_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend9_1/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaL13_channelGHK /output/plot_out SAVE Gk


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US175gradSTDP.g ===



str cellpath = "/cell"
str othercell = "/othercell"


include RebekahSims/SpikeMakerSTDP.g
include RebekahSims/add_outputgradSTDP




create compartment {othercell}
addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_2/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_3/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_4/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_5/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_6/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_7/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_8/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_9/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_10/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_11/spikegen INPUT Vm

addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend2_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend3_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend4_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend5_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend6_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend7_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend8_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend9_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend10_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend11_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend12_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend13_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend14_1/spikegen INPUT Vm


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/if4.g ===
//genesis
//IF2.g

function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm

	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KAf_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KDR_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KAs_channel /output/plot_out  SAVE Gk

	addmsg /cell/secdend11/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/secdend11/SK_channel /output/plot_out  SAVE Gk
/*
	addmsg /cell/soma/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/secdend11/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL12_channelGHK /output/plot_out SAVE Gk
		

	addmsg /cell/soma/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/primdend1/fluorescence /output/plot_out SAVE ratio


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US50noAPSTDP.g ===



str cellpath = "/cell"
str othercell = "/othercell"


include RebekahSims/SpikeMakerSTDP.g
include RebekahSims/add_outputgradSTDP




create compartment {othercell}
addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_2/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_3/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_4/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_5/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_6/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_7/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_8/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_9/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_10/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_11/spikegen INPUT Vm

addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend2_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend3_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend4_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend5_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend6_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend7_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend8_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend9_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend10_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend11_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend12_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend13_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend14_1/spikegen INPUT Vm


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US290.g ===


add_output

float inj = 800e-12
int Hz = 10  //for glu, function incrases by 2.5 this for GABA
float upstate_time = 0.3
float AP_time = 0.290  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms


str stimtype = "AP290flat"
str diskpath={diskpath1}@(stimtype)@{spiketypeFlat}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

	makeallpreFlat {Hz}

step 0.05 -time

	makeallpostFlat

step {AP_time} -time
	
	setfield {cellpath}/soma inject {inj}

step {AP_durtime} -time

	setfield {cellpath}/soma inject 0
	
step {{upstate_time}-{AP_time}-{AP_durtime}} -time

	StopAllFlat

step 0.2 -t




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/SpikeMakerFlat.g ===

str spiketypeFlat = "SpikeF1"

//F1 = glu *4; GABA *7

//these three functions used to provide synaptic input to neuron

function makeinputpreFlat(rate, path)
    str rate
    str path
    create randomspike {path}/randomspike
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*{4}} reset 1 reset_value 0	
    create randomspike {path}/randomspike2
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*{7}} reset 1 reset_value 0	
 end
	
function makeinputpostFlat(pathspike, path) 
	str path
	int msgnum
	addmsg {pathspike} {path} SPIKE
    	msgnum = {getfield {path} nsynapses} - 1
   	 setfield {path} \
  	 synapse[{msgnum}].weight 1 synapse[{msgnum}].delay 0
end


function stopinputFlat(path)
	str path
	deletemsg {path} 1 -incoming
end

function stopinput2Flat (path)
	str path
	deletemsg {path} 1 -incoming
end

function deletespikesFlat (path)
    str path
    delete {path}/randomspike
    delete {path}/randomspike2


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US5grad.g ===

str cellpath = "/cell"


include RebekahSims/SpikeMaker.g
include RebekahSims/add_outputPools.g

add_output

str stimtype = "5APgrad"
str diskpath={diskpath1}@(stimtype)@{spiketype}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

call /output/plot_out OUT_OPEN
call /output/plot_out OUT_WRITE "time SomaVm tert1pool tert5pool tert9pool tert13pool tert1volavg tert5volavg tert9volavg tert13volavg tert1dif1 tert5dif1 tert9dif1 tert13dif1 tert1F2 tert5F2 tert9F2 tert13F2 tert1NMDA tert5NMDA tert9NMDA tert13NMDA" //header	
int Hz = 10 //for glu, function multiplies this by 2 for GABA
float upstate_time = 0.3
float AP_time = 0.005  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms
float high_time = 0.01
float med_time  = 0.2
float low_time  = 0.09
float injection = 800e-12

// use randomspike to put inputs into NMDA and AMPA receptors 
deleteALLspikes
makeALLpre {Hz}


step 0.05 -time

makeALLpost "high"

	step {AP_time} -time

		setfield {cellpath}/soma inject {injection}

	step {AP_durtime} -time


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/SpikeMaker.g ===


str spiketype = "spke18"

//1: high=*50, med =*1, low =/1.5, gaba = *2
//2: high=*40, med =*1, low =/1.5, gaba = *2
//3: high=*40, med =*1, low =/1.5, gaba = *3
//4: high=*40, med =*1, low =/1.5, gaba = *4
//4r: high=*40, med =*5, low =/1, gaba = *7
//4ra: high=*30, med =*4, low =/1, gaba = *7
//4rb: high=*30, med =*3, low =/1, gaba = *7
//5: high=*60, med =/2, low =/5, gaba = *4
//6: high=*30, med =*1, low =/1.5, gaba = *4
//7r: high=*50, med=*5, low =*1, GABA = *7  gaba delay
//8r: high=*70, med=*5, low =*1, GABA = *10
//9r: high=*90, med=*5, low =*1, GABA = *10
//10r: high=*120, med=*1, low =*1, GABA = *10
//11r: high=*200, med=/2, low =/2, GABA = *40
//12y: high=*50, med=*1, low=/2, gaba = *8
//13y: high=*30, med=*5, low=/1.5, gaba=*5
//14y: high=*45, med=*1, low=*1, gaba=*5
//15y: high=*45, med=*10, low=*1, gaba=*5
//16y: high=*40, med=*5, low=*1, gaba=*10
//17y: high=*40, med=*5, low=*1, gaba=*7
//18: high=*50, med=*3, low=*1, gaba=*7

//****start local subroutines

function makeinputpre(rate, path)
    str rate
    str path
    create randomspike {path}/randomspikehigh
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*50} reset 1 reset_value 0	
    create randomspike {path}/randomspikemed
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*3} reset 1 reset_value 0	
    create randomspike {path}/randomspikelow
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}} reset 1 reset_value 0	
    create randomspike {path}/randomspike2
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*7} reset 1 reset_value 0	
 end


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_outputgrad2.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm

	addmsg /cell/tertdend1_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend5_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend9_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend13_1 /output/plot_out SAVE Vm
/*
	addmsg /cell/tertdend1_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_1/Fluo5FVavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend5_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend9_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend13_1/NMDApool /output/plot_out SAVE Ca
	
	addmsg /cell/tertdend1_1/Lpool /output/plot_out SAVE Ca
	addmsg /cell/tertdend5_1/Lpool /output/plot_out SAVE Ca
	addmsg /cell/tertdend9_1/Lpool /output/plot_out SAVE Ca
	addmsg /cell/tertdend13_1/Lpool /output/plot_out SAVE Ca
*/
	addmsg /cell/tertdend1_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend5_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend9_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend13_1/fluorescence /output/plot_out SAVE ratio
/*
	addmsg /cell/tertdend1_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_1/volavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_1/NR2A/GHK /output/plot_out SAVE Gk


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US10grad.g ===


add_output
float inj = 800e-12
str stimtype = "10APgrad"
str diskpath={diskpath1}@(stimtype)@{spiketypeGrad}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

int Hz = 10 //for glu, function multiplies this by 2 for GABA
float upstate_time = 0.3
float AP_time = 0.01  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms
float high_time = 0.01
float med_time  = 0.2
float low_time  = 0.09

// use randomspike to put inputs into NMDA and AMPA receptors 

makeALLpreGrad {Hz}


step 0.05 -time

makeALLpostGrad "high"

	step {AP_time} -time

		setfield {cellpath}/soma inject {inj}

stopGluGrad
stopGABAGrad
makeALLpostGrad "med"

	step {AP_durtime} -time
		
		setfield {cellpath}/soma inject 0


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US30.g ===


add_output

float inj = 800e-12
int Hz = 10  //for glu, function incrases by 2.5 this for GABA
float upstate_time = 0.3
float AP_time = 0.03  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms


str stimtype = "AP30flat"
str diskpath={diskpath1}@(stimtype)@{spiketypeFlat}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

	makeallpreFlat {Hz}

step 0.05 -time

	makeallpostFlat

step {AP_time} -time
	
	setfield {cellpath}/soma inject {inj}

step {AP_durtime} -time

	setfield {cellpath}/soma inject 0
	
step {{upstate_time}-{AP_time}-{AP_durtime}} -time

	StopAllFlat

step 0.2 -t




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_outputUS.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	addmsg /cell/tertdend1_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend5_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend9_1 /output/plot_out SAVE Vm
	addmsg /cell/tertdend13_1 /output/plot_out SAVE Vm

	addmsg /cell/tertdend1_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend5_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend9_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend9_1/fluorescence /output/plot_out SAVE ratio

	addmsg /cell/tertdend1_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_1/volavg /output/plot_out SAVE meanValue
/*
	addmsg /cell/tertdend1_1/NR2A/GHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/NR2A/block /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/NR2A/GHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/NR2A/block /output/plot_out SAVE Gk
	addmsg /cell/tertdend9_1/NR2A/GHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend9_1/NR2A/block /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaL12_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/CaL12_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend9_1/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend9_1/CaL13_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend5_1/CaN_channelGHK /output/plot_out SAVE Gk


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/if2noproto.g ===
//genesis
//IF2noproto.g

function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Gk
	addmsg /cell/secdend11/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/secdend11/SK_channel /output/plot_out  SAVE Gk
		
  if (calciumtype==0)
	addmsg /cell/soma/Ca_difshell_1 /output/plot_out SAVE C
	addmsg /cell/primdend1/Ca_difshell_1 /output/plot_out SAVE C
	addmsg /cell/secdend11/Ca_difshell_1 /output/plot_out SAVE C
	addmsg /cell/tertdend1_1/Ca_difshell_1 /output/plot_out SAVE C
	addmsg /cell/tertdend1_6/Ca_difshell_1 /output/plot_out SAVE C

  elif (calciumtype==1) //single time constant of decay
	addmsg /cell/soma/Ca_difshell_1 /output/plot_out SAVE Ca
	addmsg /cell/primdend1/Ca_difshell_1 /output/plot_out SAVE Ca
	addmsg /cell/secdend11/Ca_difshell_1 /output/plot_out SAVE Ca
	addmsg /cell/tertdend1_1/Ca_difshell_1 /output/plot_out SAVE Ca
	addmsg /cell/tertdend1_6/Ca_difshell_1 /output/plot_out SAVE Ca
  else
    echo "unrecognized calcium type"
  end
end

add_output
str stimtype

stimtype="IF-500"
diskpath={diskpath}@(stimtype)@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_outputDistance.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm

	addmsg /cell/primdend1/volavg /output/plot_out SAVE meanValue 
	addmsg /cell/primdend2/volavg /output/plot_out SAVE meanValue
	addmsg /cell/primdend3/volavg /output/plot_out SAVE meanValue
	addmsg /cell/primdend4/volavg /output/plot_out SAVE meanValue

	addmsg /cell/secdend11/volavg /output/plot_out SAVE meanValue 
	addmsg /cell/secdend21/volavg /output/plot_out SAVE meanValue
	addmsg /cell/secdend31/volavg /output/plot_out SAVE meanValue
	addmsg /cell/secdend41/volavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_1/volavg /output/plot_out SAVE meanValue 
	addmsg /cell/tertdend9_1/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_1/volavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_2/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_2/volavg /output/plot_out SAVE meanValue 
	addmsg /cell/tertdend9_2/volavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_2/volavg /output/plot_out SAVE meanValue
end

/* copy into header.g file: 
call /output/plot_out OUT_OPEN
call /output/plot_out OUT_WRITE "time SomaVm prim1volavg prim2volavg prim3volavg prim4volavg sec11volavg sec21volavg sec31volavg sec41volavg tert1_1volavg tert5_1volavg tert9_1volavg tert13_1volavg tert1_2volavg tert5_2volavg tert9_2volavg tert13_2volavg" //header	
*/




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/Shindou3AP.g ===
//genesis Shindou3AP.g

include RebekahSims/addoutput.g
str cellpath = "/cell"
add_output

str stimtype = "Shindou3APonly"
diskpath={diskpath}@(stimtype)@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

setfield /output/plot_out filename output/{diskpath}
		call /output/plot_out OUT_OPEN
		call /output/plot_out OUT_WRITE "time SomaVm somaVavg primVavg secVavg tertVavg" //header


step 0.1 -time

	//setfield {cellpath}/tertdend1_1/presyn_ext z {1/{getclock 0}}
	
step 1

	//setfield {cellpath}/tertdend1_1/presyn_ext z 0

step 0.01 -time
//Shindou uses 100Hz triplets
	
	step 0 -time	
	setfield {cellpath}/soma inject 1e-9 
	step 0.005 -time
	setfield {cellpath}/soma inject 0
	step 0.005 -time
	setfield {cellpath}/soma inject 1e-9 
	step 0.005 -time
	setfield {cellpath}/soma inject 0
	step 0.005 -time
	setfield {cellpath}/soma inject 1e-9 
	step 0.005 -time
	setfield {cellpath}/soma inject 0


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US30grad.g ===


add_output
float inj = 800e-12
str stimtype = "30APgrad"
str diskpath={diskpath1}@(stimtype)@{spiketypeGrad}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

int Hz = 10 //for glu, function multiplies this by 2 for GABA
float upstate_time = 0.3
float AP_time = 0.03  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms
float high_time = 0.01
float med_time  = 0.2
float low_time  = 0.09

// use randomspike to put inputs into NMDA and AMPA receptors 

makeALLpreGrad {Hz}


step 0.05 -time

makeALLpostGrad "high"

	step {high_time} -time

stopGluGrad
stopGABAGrad
makeALLpostGrad "med"

	step {{AP_time}-{high_time}} -time

		setfield {cellpath}/soma inject {inj}

	step {AP_durtime} -time


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/if5.g ===
//genesis
//IF2.g

function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	//addmsg /cell/soma/NaF_channel /output/plot_out  SAVE Gk
/*
	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KAf_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KDR_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KAs_channel /output/plot_out  SAVE Gk

	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Gk

	addmsg /cell/soma/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/secdend11/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL12_channelGHK /output/plot_out SAVE Gk
		

	addmsg /cell/soma/fluorescence /output/plot_out SAVE ratio


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US20.g ===


add_output

float inj = 800e-12
int Hz = 10  //for glu, function incrases by 2.5 this for GABA
float upstate_time = 0.3
float AP_time = 0.02  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms


str stimtype = "AP20flat"
str diskpath={diskpath1}@(stimtype)@{spiketypeFlat}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

	makeallpreFlat {Hz}

step 0.05 -time

	makeallpostFlat

step {AP_time} -time
	
	setfield {cellpath}/soma inject {inj}

step {AP_durtime} -time

	setfield {cellpath}/soma inject 0
	
step {{upstate_time}-{AP_time}-{AP_durtime}} -time

	StopAllFlat

step 0.2 -t




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/PairedPulse.g ===
//genesis PairedPulse.g

include RebekahSims/addoutput.g

add_output
str cellpath = "/cell"
str stimtype = "PP50ms"
diskpath={diskpath}@(stimtype)@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

setfield /output/plot_out filename output/{diskpath}
		call /output/plot_out OUT_OPEN
		call /output/plot_out OUT_WRITE "time SomaVm somaVavg primVavg secVavg tertVavg" //header

int i
float isi = 0.05 //50ms

for (i=0; i<1; i=i+1)
	step 0.1 -time

		setfield {cellpath}/secdend11/presyn_ext z {1/{getclock 0}}
		
	step 1

		setfield {cellpath}/secdend11/presyn_ext z 0

	step {isi} -time
	
		setfield {cellpath}/secdend11/presyn_ext z {1/{getclock 0}}
		
	step 1
	
		setfield {cellpath}/secdend11/presyn_ext z 0
		
	step 0.5 -time
	isi={isi}+0.01
end 


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/hfs.g ===
//genesis HFS.g


include RebekahSims/addoutput.g
str cellpath = "/cell"
add_output

str stimtype = "HFS"
diskpath={diskpath}@(stimtype)@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

setfield /output/plot_out filename output/{diskpath}
		call /output/plot_out OUT_OPEN
		call /output/plot_out OUT_WRITE "time SomaVm somaVavg primVavg secVavg tertVavg" //header

int i
int j

step 0.1 -time

//for (i=0; i<4; i=i+1)
	for (j=0; j<100; j=j+1)	
		setfield {cellpath}/tertdend1_1/presyn_ext z {1/{getclock 0}}
		step 1
		setfield {cellpath}/tertdend1_1/presyn_ext z 0
		step 0.01 -time
	end
	//step 10 -time 
//end 






=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US20tester.g ===



/****************begin local subroutines*************/
function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm

	addmsg /cell/tertdend1_1/fluorescence /output/plot_out SAVE ratio
	
	addmsg /cell/tertdend2_1/fluorescence /output/plot_out SAVE ratio
	
	addmsg /cell/tertdend3_1/fluorescence /output/plot_out SAVE ratio

	addmsg /cell/tertdend1_1/NR2A/GHK /output/plot_out SAVE Ik
	addmsg /cell/tertdend1_1/NR2A/block /output/plot_out SAVE Ik
	addmsg /cell/tertdend2_1/NR2A/GHK /output/plot_out SAVE Ik
	addmsg /cell/tertdend2_1/NR2A/block /output/plot_out SAVE Ik
	addmsg /cell/tertdend3_1/NR2A/GHK /output/plot_out SAVE Ik
	addmsg /cell/tertdend3_1/NR2A/block /output/plot_out SAVE Ik


end



//these three functions used to provide synaptic input to neuron

function makeinputpre(rate, path)
    str rate
    str path
    create randomspike {path}/randomspike
    setfield ^ min_amp 1.0 max_amp 1.0 rate {rate} reset 1 reset_value 0	
    create randomspike {path}/randomspike2
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*{2}} reset 1 reset_value 0	
 end
	


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/PairedPulse2.g ===
//genesis PairedPulse2.g

include RebekahSims/addoutput.g

add_output
str cellpath = "/cell"
str othercell = "/othercell"
str stimtype = "PPtrain"
diskpath={diskpath}@(stimtype)@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

setfield /output/plot_out filename output/{diskpath}
		call /output/plot_out OUT_OPEN
		call /output/plot_out OUT_WRITE "time SomaVm secVm SecVavg secNMDAgk secAMPAgk secFura" //header

//because we are using the facsynchan which cannot recieve activation messages, we have to use spikegen 
//objects and send input into them.
 
	create compartment {othercell}
	addmsg {othercell} {cellpath}/secdend11/spikegen INPUT Vm
int i
float isi = 0.01 //50ms

for (i=0; i<5; i=i+1)
	call /output/plot_out OUT_WRITE "/newplot" 
	call /output/plot_out OUT_WRITE "/plotname " {isi} 
	step 0.1 -time

		setfield {othercell} Vm 10
		
	step 1

		setfield {othercell} Vm -0.090

	step {isi} -time
	
		setfield {othercell} Vm 10
		


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_outputPools.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	
	addmsg /cell/tertdend1_1/allpool /output/plot_out SAVE Ca
	addmsg /cell/tertdend5_1/allpool /output/plot_out SAVE Ca
	addmsg /cell/tertdend9_1/allpool /output/plot_out SAVE Ca
	addmsg /cell/tertdend13_1/allpool /output/plot_out SAVE Ca

	addmsg /cell/tertdend1_1/volavg /output/plot_out SAVE meanValue 
	addmsg /cell/tertdend5_1/volavg /output/plot_out SAVE meanValue 
	addmsg /cell/tertdend9_1/volavg /output/plot_out SAVE meanValue 
	addmsg /cell/tertdend13_1/volavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_1/Ca_difshell_1 /output/plot_out SAVE C
	addmsg /cell/tertdend5_1/Ca_difshell_1 /output/plot_out SAVE C
	addmsg /cell/tertdend9_1/Ca_difshell_1 /output/plot_out SAVE C
	addmsg /cell/tertdend13_1/Ca_difshell_1 /output/plot_out SAVE C
/*
	addmsg /cell/tertdend1_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend5_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend9_1/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/tertdend13_1/fluorescence /output/plot_out SAVE ratio
*/
	addmsg /cell/tertdend1_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend5_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend9_1/NMDApool /output/plot_out SAVE Ca
	addmsg /cell/tertdend13_1/NMDApool /output/plot_out SAVE Ca

end

/* copy into file: 
call /output/plot_out OUT_OPEN
call /output/plot_out OUT_WRITE "time SomaVm tert1pool tert5pool tert9pool tert13pool tert1volavg tert5volavg tert9volavg tert13volavg tert1dif1 tert5dif1 tert9dif1 tert13dif1 tert1NMDA tert5NMDA tert9NMDA tert13NMDA" //header	
//call /output/plot_out OUT_WRITE "time SomaVm tert1pool tert5pool tert9pool tert13pool tert1volavg tert5volavg tert9volavg tert13volavg tert1dif1 tert5dif1 tert9dif1 tert13dif1 tert1F2 tert5F2 tert9F2 tert13F2 tert1NMDA tert5NMDA tert9NMDA tert13NMDA" //header	


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/SpontAP.g ===



include RebekahSims/add_outputgrad2

//these three functions used to provide synaptic input to neuron

function makeinputpre(rate, path)
    str rate
    str path
    create randomspike {path}/randomspike
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*6} reset 1 reset_value 0	
    create randomspike {path}/randomspike2
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*7} reset 1 reset_value 0	
 end
	
function makeinputpost(pathspike, path) 
	str path
	int msgnum
	addmsg {pathspike} {path} SPIKE
    	msgnum = {getfield {path} nsynapses} - 1
   	setfield {path} \
  	synapse[{msgnum}].weight 1 synapse[{msgnum}].delay 0
end


function stopinput (path)
	str path
	deletemsg {path} 2 -incoming
end

function stopinput2 (path)
	str path
	deletemsg {path} 1 -incoming
end


/*********end local subroutines*****************/

add_output


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US5.g ===

include RebekahSims/add_outputPools

//these three functions used to provide synaptic input to neuron

function makeinputpre(rate, path)
    str rate
    str path
    create randomspike {path}/randomspike
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*4} reset 1 reset_value 0	
    create randomspike {path}/randomspike2
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*7} reset 1 reset_value 0	
 end
	
function makeinputpost(pathspike, path) 
	str path
	int msgnum
	addmsg {pathspike} {path} SPIKE
    	msgnum = {getfield {path} nsynapses} - 1
   	 setfield {path} \
  	 synapse[{msgnum}].weight 1 synapse[{msgnum}].delay 0
end


function stopinput(path)
	str path
	deletemsg {path} 2 -incoming
end

function stopinput2 (path)
	str path
	deletemsg {path} 1 -incoming
end

function deletespikes (path)
    str path
    delete {path}/randomspike
    delete {path}/randomspike2
end 



=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/USnoAP.g ===


add_output

float inj = 0
int Hz = 10  //for glu, function incrases by 2.5 this for GABA
float upstate_time = 0.3
float AP_time = 0.290  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms


str stimtype = "noAPflat"
str diskpath={diskpath1}@(stimtype)@{spiketypeFlat}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

	makeallpreFlat {Hz}

step 0.05 -time

	makeallpostFlat

step {AP_time} -time
	
	setfield {cellpath}/soma inject {inj}

step {AP_durtime} -time

	setfield {cellpath}/soma inject 0
	
step {{upstate_time}-{AP_time}-{AP_durtime}} -time

	StopAllFlat

step 0.2 -t




=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/add_outputgrad5.g ===


function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	
	addmsg /cell/primdend1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/primdend2/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/primdend3/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/primdend4/Fluo5FVavg /output/plot_out SAVE meanValue

	addmsg /cell/secdend11/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/secdend21/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/secdend31/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/secdend41/Fluo5FVavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_1/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_1/Fluo5FVavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_2/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_2/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_2/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_2/Fluo5FVavg /output/plot_out SAVE meanValue

	addmsg /cell/tertdend1_3/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend5_3/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend9_3/Fluo5FVavg /output/plot_out SAVE meanValue
	addmsg /cell/tertdend13_3/Fluo5FVavg /output/plot_out SAVE meanValue

end

/* copy into file: 
call /output/plot_out OUT_OPEN
call /output/plot_out OUT_WRITE "time SomaVm prim1F5F prim2F5F prim3F5F prim4F5F sec11F5F sec21F5F sec31F5F sec41F5f tert1_1F5F tert5_1F5F tert9_1F5F tert13_1F5F tert1_2F5F tert5_2F5F tert9_2F5F tert13_2F5F tert1_3F5F tert5_3F5F tert9_3F5F tert13_3F5F" //header	
*/


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US100noAPSTDP.g ===



str cellpath = "/cell"
str othercell = "/othercell"


include RebekahSims/SpikeMakerSTDP.g
include RebekahSims/add_outputgradSTDP




create compartment {othercell}
addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_2/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_3/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_4/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_5/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_6/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_7/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_8/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_9/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_10/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_11/spikegen INPUT Vm

addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend2_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend3_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend4_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend5_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend6_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend7_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend8_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend9_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend10_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend11_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend12_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend13_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend14_1/spikegen INPUT Vm


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/addoutput.g ===
//addoutput.g
	// function for saving parameter in ascii file.  
	//function is made and called in this file
	
//make function 

function sav_disk_asc(diskpath,srcpath,field)
    create asc_file /output/{diskpath}
    setfield /output/{diskpath}   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/{diskpath} 0
    setfield /output/{diskpath} filename output/{diskpath}
    addmsg {srcpath} /output/{diskpath}  SAVE {field}
    call /output/{diskpath} OUT_OPEN
    call /output/{diskpath} OUT_WRITE "time #1" //header
    echo {diskpath}
end
		
		
		
//call function
	
	/*******************save soma information****************************************************
		sav_disk_asc somaVm{subunit}{stimtype} {cellpath}/soma Vm
	*******************************************************************************************/
	
	/*******************save secondary dendrite parameters**************************************
		//sav_disk_asc dendCa{subunit}{stimtype} {cellpath}/secdend3/{CalciumBuffer_3} Ca  
		sav_disk_asc NMDACa{subunit}{stimtype} {cellpath}/secdend3/spine_1/head/buffer_NMDA Ca
		//sav_disk_asc spineCa{subunit}{stimtype} {cellpath}/secdend3/spine_1/head/SpineCa Ca
		//sav_disk_asc LspineCa{subunit}{stimtype} {cellpath}/secdend3/spine_1/head/SpineCaL Ca
		//sav_disk_asc Ikblock{subunit}{stimtype} {cellpath}/secdend3/spine_1/head/{subunit}/block Ik
		//sav_disk_asc spineVm{subunit}{stimtype} {cellpath}/secdend3/spine_1/head Vm
	*******************************************************************************************/
 
	/******************save tertiary dendrite information****************************************
		sav_disk_asc dendCa{subunit}{stimtype}3 {cellpath}/tertdend3/{CalciumBuffer_3} Ca
		sav_disk_asc spineCa{subunit}{stimtype}3 {cellpath}/tertdend3/tert_dend5/spine_1/head/buffer_NMDA
		sav_disk_asc Ikblock{subunit}{stimtype}3 {cellpath}/tertdend3/tert_dend5/spine_1/head/{subunit}/block Ik Ca
		sav_disk_asc spineVm{subunit}{stimtype}3 {cellpath}/tertdend3/tert_dend5/spine_1/head Vm


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/SpikeMakerGrad.g ===


str spiketypeGrad = "spke18"

//18: high=*50, med=*3, low=*1, gaba=*7
//19: high=*40, med=*5, low=*2, gaba=*7

//****start local subroutines

function makeinputpreGrad(rate, path)
    str rate
    str path
    create randomspike {path}/randomspikehigh
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*50} reset 1 reset_value 0	
    create randomspike {path}/randomspikemed
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*3} reset 1 reset_value 0	
    create randomspike {path}/randomspikelow
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*1} reset 1 reset_value 0	
    create randomspike {path}/randomspike2
    setfield ^ min_amp 1.0 max_amp 1.0 rate {{rate}*7} reset 1 reset_value 0	
 end
	
function makeinputpostGrad(pathspike, path) 
	str path
	int msgnum
	addmsg {pathspike} {path} SPIKE
    	msgnum = {getfield {path} nsynapses} - 1
   	setfield {path} \
  	synapse[{msgnum}].weight 1 synapse[{msgnum}].delay 0
end


function stopinputGrad (path)
	str path
	deletemsg {path} 1 -incoming
end

function stopinput2Grad (path)
	str path
	deletemsg {path} 1 -incoming


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/USnoAPgrad.g ===


add_output

float inj = 0 //ALWAYS zero for no AP
str stimtype = "noAPgrad"
str diskpath={diskpath1}@(stimtype)@{spiketypeGrad}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

int Hz = 10 //for glu, function multiplies this by 2 for GABA
float upstate_time = 0.3
float AP_time = 0.01  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms
float high_time = 0.01
float med_time  = 0.2
float low_time  = 0.09

// use randomspike to put inputs into NMDA and AMPA receptors 

makeALLpreGrad {Hz}

step 0.05 -time

makeALLpostGrad "high"

	step {AP_time} -time

		setfield {cellpath}/soma inject {inj}

stopGluGrad
stopGABAGrad
makeALLpostGrad "med"

	step {AP_durtime} -time
		
		setfield {cellpath}/soma inject 0


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US290grad.g ===



add_output
float inj = 800e-12
str stimtype = "290APgrad"
str diskpath={diskpath1}@(stimtype)@{spiketypeGrad}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

int Hz = 10 //for glu, function multiplies this by 2 for GABA
float upstate_time = 0.3
float AP_time = 0.29  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms
float high_time = 0.01
float med_time  = 0.2
float low_time  = 0.09

// use randomspike to put inputs into NMDA and AMPA receptors 

makeALLpreGrad {Hz}


step 0.05 -time

makeALLpostGrad "high"

	step {high_time} -time

stopGluGrad
stopGABAGrad
makeALLpostGrad "med"

	step {med_time} -time
	

stopGluGrad


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US175grad.g ===


add_output

float inj = 800e-12
str stimtype = "175APgrad"
str diskpath={diskpath1}@(stimtype)@{spiketypeGrad}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

int Hz = 10 //for glu, function multiplies this by 2 for GABA
float upstate_time = 0.3
float AP_time = 0.175  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms
float high_time = 0.01
float med_time  = 0.2
float low_time  = 0.09

// use randomspike to put inputs into NMDA and AMPA receptors 

makeALLpreGrad {Hz}


step 0.05 -time

makeALLpostGrad "high"

	step {high_time} -time

stopGluGrad
stopGABAGrad
makeALLpostGrad "med"

	step {{AP_time}-{high_time}} -time

		setfield {cellpath}/soma inject {inj}



=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US50grad.g ===


add_output
float inj = 800e-12
str stimtype = "50APgrad"
str diskpath={diskpath1}@(stimtype)@{spiketypeGrad}@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset

include RebekahSims/header.g

int Hz = 10 //for glu, function multiplies this by 2 for GABA
float upstate_time = 0.3
float AP_time = 0.05  //AP latency from upstate onset
float AP_durtime = 0.005 //duration of AP depolarization at soma, 5 ms
float high_time = 0.01
float med_time  = 0.2
float low_time  = 0.09

// use randomspike to put inputs into NMDA and AMPA receptors 

makeALLpreGrad {Hz}


step 0.05 -time

makeALLpostGrad "high"

	step {high_time} -time

stopGluGrad
stopGABAGrad
makeALLpostGrad "med"

	step {{AP_time}-{high_time}} -time

		setfield {cellpath}/soma inject {inj}

	step {AP_durtime} -time


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/ifBKSKtest.g ===
//genesis
//IF2.g

function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm

	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KAf_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KDR_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KAs_channel /output/plot_out  SAVE Gk
/*
	addmsg /cell/secdend11/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/secdend11/SK_channel /output/plot_out  SAVE Gk

	addmsg /cell/soma/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/secdend11/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL12_channelGHK /output/plot_out SAVE Gk
		

	addmsg /cell/soma/fluorescence /output/plot_out SAVE ratio
	addmsg /cell/primdend1/fluorescence /output/plot_out SAVE ratio


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/simVclamp.g ===
//genesis
//IF2.g

function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm

	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Gk
	addmsg /cell/secdend11/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/secdend11/SK_channel /output/plot_out  SAVE Gk

	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Ik
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Ik
	addmsg /cell/secdend11/BK_channel /output/plot_out  SAVE Ik
	addmsg /cell/secdend11/SK_channel /output/plot_out  SAVE Ik
/*
	addmsg /cell/soma/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/secdend11/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/tertdend1_1/CaL12_channelGHK /output/plot_out SAVE Gk
		

	addmsg /cell/soma/fluorescence /output/plot_out SAVE ratio


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/if2.g ===
//genesis
//IF2.g

function add_output
	create asc_file /output/plot_out
	setfield /output/plot_out   flush 1  leave_open 1 append 1 \
          float_format %0.6g
    useclock /output/plot_out 1
	addmsg /cell/soma /output/plot_out  SAVE Vm
	addmsg /cell/primdend1 /output/plot_out  SAVE Vm
	addmsg /cell/secdend11 /output/plot_out  SAVE Vm
	addmsg /cell/tertdend1_1 /output/plot_out  SAVE Vm
	addmsg /cell/tertdend1_2 /output/plot_out  SAVE Vm
	addmsg /cell/tertdend1_3 /output/plot_out  SAVE Vm
	addmsg /cell/tertdend1_4 /output/plot_out  SAVE Vm

	//addmsg /cell/soma/NaF_channel /output/plot_out  SAVE Gk
/*
	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KAf_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KDR_channel /output/plot_out  SAVE Gk
	//addmsg /cell/soma/KAs_channel /output/plot_out  SAVE Gk

	addmsg /cell/soma/BK_channel /output/plot_out  SAVE Gk
	addmsg /cell/soma/SK_channel /output/plot_out  SAVE Gk

	addmsg /cell/soma/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/soma/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/secdend11/CaR_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaN_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaT_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL13_channelGHK /output/plot_out SAVE Gk
	addmsg /cell/secdend11/CaL12_channelGHK /output/plot_out SAVE Gk

	addmsg /cell/tertdend1_1/CaR_channelGHK /output/plot_out SAVE Gk


=== Following is the header of samples/150912/EvansEtAl2013/RebekahSims/US100gradSTDP.g ===



str cellpath = "/cell"
str othercell = "/othercell"


include RebekahSims/SpikeMakerSTDP.g
include RebekahSims/add_outputgradSTDP




create compartment {othercell}
addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_2/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_3/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_4/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_5/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_6/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_7/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_8/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_9/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_10/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend1_11/spikegen INPUT Vm

addmsg {othercell} {cellpath}/tertdend1_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend2_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend3_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend4_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend5_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend6_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend7_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend8_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend9_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend10_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend11_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend12_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend13_1/spikegen INPUT Vm
addmsg {othercell} {cellpath}/tertdend14_1/spikegen INPUT Vm


=== Following is the header of samples/150912/EvansEtAl2013/graphics7.g ===
//genesis


/***************************		MS Model, Version 9.1	*********************
**************************** 	      graphics3.g 	*********************
	Avrama Blackwell 	kblackw1@gmu.edu
	Wonryull Koh		wkoh1@gmu.edu
	Rebekah Evans 		rcolema2@gmu.edu
	Sriram 				dsriraman@gmail.com	
******************************************************************************

*****************************************************************************/


/*********************** Begin Local Subroutines *****************************/
/*****************************************************************************/

	//************************ Begin function record_channel *******************
	function record_channel(compt,channel,xcell, color)
 		str compt,xcell,channel, color		
 		str path, graphic_path
                       
		path = {neuronname}@"/"@{compt}@"/"@{channel}
		if ({channel}=="Ca_difshell_1"||{channel}=="Ca_difshell_2"||	\
															{channel}=="Ca_difshell_3")
			if( {isa difshell {path}})
				addmsg {neuronname}/{compt}/{channel} 							\
										{xcell}/Ca PLOT C  *	{channel}  *{color}
			elif( {isa Ca_concen {path}})
				addmsg {neuronname}/{compt}/{channel} 							\
										{xcell}/Ca PLOT Ca *{compt}  *{color}
			end
		else 
			addmsg {neuronname}/{compt}/{channel} {xcell}/channels 			\
										PLOT Ik *{channel} *{color}
		end 
	end
	//************************ End function record_channel *********************
	//**************************************************************************



=== Following is the header of samples/150912/EvansEtAl2013/MSsimSyn.g ===
                       //genesis
// MSsim.g 

/***************************		MS Model, Version 9.1	***************
*******************************************************************************
****************************** Begin includes *******************************/

str 	neuronname = "/cell"
str pfile="MScell/MScelltapershortCM3noproto.p" //thickdends
include MScell/MScellSyn	// access make_MS_cell this function is only called from MSsim.g
include graphics7		        // access functions make_control & make_graph
include RebekahSims/Store_Parameters.g
			     
// These two functions are only called from MSsimSyn.g
/****************************** End includes *********************************/
float outputclock=2e-5

	setclock 0 5e-6   // Simulation time step (Second)       
	setclock 1 {outputclock}

	makeMScellSyn {neuronname} {pfile}	// MS_cell.g

	reset

/* these graphics no longer work because of some globals and cell names
 * need to edit to pass in neuronname, etc. But, would be better to write to file. */
//	make_control		// graphics.g


	 make_graph {neuronname}		// graphics.g
		
/*uncomment the following lines (and one line in MScell.g) to use the hsolver
        setfield  {neuronname}  chanmode 1 
        call {neuronname} SETUP
        setmethod 11
*/	
	reset

/****************************** End MSsimSyn.g **********************************/
str diskpath1="11.008NaFda1g1noCaT"


=== Following is the header of samples/150912/EvansEtAl2013/MScell/CaDifshellSpine.g ===
//genesis

/***************************		MS Model, Version 8	*********************
**************************** 	      CaDifshellSpines.g 	*********************
	Avrama Blackwell 	kblackw1@gmu.edu
	Wonryull Koh		wkoh1@gmu.edu
	Rebekah Evans 		rcolema2@gmu.edu
	Sriram 			dsriraman@gmail.com	
	Tom Sheehan 		tsheeha2@gmu.edu	
******************************************************************************
This file is a lot like CaDifshell.g, but is adjusted to make difshells in spines.
some key adjustments are that these difshells are in 'slab' format rather than 'onion'
and that these difshells start thinner than the main compartment difshells.
*****************************************************************************/

include MScell/New_Calcium/Ca_constants.g

//***************************** Begin Local Subroutine ***********************


function create_difshellspine (shellName, base, r, shellThickness)
	str shellName
	float base
	float r, shellThickness
	create difshell {shellName}
	setfield {shellName}	\
		C    {base}	\
        Ceq  {base}	\
        D    {dca}	\ //D_Ca = 2e-6 (cm^2)(s^(-1))
        val  2	\
        leak 0	\
        shape_mode {SLAB}	\ 
        dia {r*2}	\	//diameter of slab cylinder (len is not used for slabs)
        thick {shellThickness}  //thickness of slab
end

function add_difbuffer_to_difshellspine (shellName, bname, btotal, kf, kb, d, r, shellThickness)
	str shellName, bname
	float btotal, kf, kb, d, compLen, r
	


=== Following is the header of samples/150912/EvansEtAl2013/MScell/MScellshortSpines.p ===
//***************************		MS Model, Version 5.0	**********************
//*************************** 	      MScell.p 			**********************
//			Tom Sheehan tsheeha2@gmu.edu	thsheeha@vt.edu	703-538-836
//*****************************************************************************

*relative
*cartesian
*asymmetric
*lambda_warn

//*set_global ELEAK -0.070
//*set_global RA 1.0 
//*set_global RM 8.695652
//*set_global RM 1.8

*set_global CM 0.01
//*set_global EREST_ACT -0.085

*start_cell /library/tert_dend
tert_dend none 17.964 0 0 0.80
tert_dend2 . 17.964 0 0 0.79 
tert_dend3 . 17.964 0 0 0.78
tert_dend4 . 17.964 0 0 0.77
tert_dend5 . 17.964 0 0 0.76
tert_dend6 . 17.964 0 0 0.75
tert_dend7 . 17.964 0 0 0.74 
tert_dend8 . 17.964 0 0 0.73
tert_dend9 . 17.964 0 0 0.72
tert_dend10 . 17.964 0 0 0.71
tert_dend11 . 17.964 0 0 0.70
*makeproto /library/tert_dend

*start_cell /library/sec_dend

sec_dend none 12 0 0 1.200
*makeproto /library/sec_dend

*start_cell /library/prim_dend

prim_dend none 10.000 0 0 2.5


=== Following is the header of samples/150912/EvansEtAl2013/MScell/MScelltapershortCM3noproto.p ===
//***************************		MS Model, Version 5.0	**********************
//*************************** 	      MScell.p 			**********************
//			Tom Sheehan tsheeha2@gmu.edu	thsheeha@vt.edu	703-538-836
//*****************************************************************************

*relative
*cartesian
*asymmetric
*lambda_warn

*set_global RA 6.0 
//change Cm to account for no spines - make 3x higher?
*set_global CM 0.03  
//RM is set in globals.g! 

*start_cell
*spherical
soma none 16.000 0 0 16.000

*cylindrical
primdend1 soma 12 0 0 1.7
primdend2 soma 12 0 0 1.7
primdend3 soma 12 0 0 1.7
primdend4 soma 12 0 0 1.7

secdend11 primdend1 14 0 0 1.4
secdend12 primdend1 14 0 0 1.4
secdend21 primdend2 14 0 0 1.4
secdend22 primdend2 14 0 0 1.4
secdend31 primdend3 14 0 0 1.4
secdend32 primdend3 14 0 0 1.4
secdend41 primdend4 14 0 0 1.4
secdend42 primdend4 14 0 0 1.4

tertdend1_1 secdend11 18  0  0  0.8
tertdend1_2 . 18 0 0 0.79 
tertdend1_3 . 18 0 0 0.78
tertdend1_4 . 18 0 0 0.77
tertdend1_5 . 18 0 0 0.76
tertdend1_6 . 18 0 0 0.75


=== Following is the header of samples/150912/EvansEtAl2013/MScell/MScelltaperspines.p ===
//***************************		MS Model, Version 5.0	**********************
//*************************** 	      MScell.p 			**********************
//			Tom Sheehan tsheeha2@gmu.edu	thsheeha@vt.edu	703-538-836
//*****************************************************************************

*relative
*cartesian
*asymmetric
*lambda_warn

//*set_global ELEAK -0.070
//*set_global RA 1.0 
//*set_global RM 8.695652
//*set_global RM 1.8
//*set_global CM 0.010 
//change Cm to account for no spines - make 3x higher?
*set_global CM 0.01  
//*set_global EREST_ACT -0.085

*start_cell /library/tert_dend
tert_dend none 35.927 0 0 0.80
tert_dend2 . 35.927 0 0 0.79 
tert_dend3 . 35.927 0 0 0.78
tert_dend4 . 35.927 0 0 0.77
tert_dend5 . 35.927 0 0 0.76
tert_dend6 . 35.927 0 0 0.75
tert_dend7 . 35.927 0 0 0.74 
tert_dend8 . 35.927 0 0 0.73
tert_dend9 . 35.927 0 0 0.72
tert_dend10 . 35.927 0 0 0.71
tert_dend11 . 35.927 0 0 0.70
*makeproto /library/tert_dend

*start_cell /library/sec_dend

sec_dend none 24.230 0 0 1.200
*makeproto /library/sec_dend

*start_cell /library/prim_dend



=== Following is the header of samples/150912/EvansEtAl2013/MScell/proto.g ===
//genesis


/***************************		MS Model, Version 9.1	*********************
**************************** 	      proto.g 	*********************
	Avrama Blackwell 	kblackw1@gmu.edu
	Wonryull Koh		wkoh1@gmu.edu
	Rebekah Evans 		rcolema2@gmu.edu
	Sriram 				dsriraman@gmail.com	
******************************************************************************

*****************************************************************************
*******************************************************************************
	proto.g is called by MScell.g
	it contains one primary routine:  
		make_prototypes
 	and two local routines 
		make_cylind_compartment
		make_spines - this one needs much work
	these are used by the primary and are not intended for external calls
	The primary function, make_prototypes is called exactly once by MSsim.g

******************************************************************************/

include MScell/include_channels.g		// required for calls in make_protypes

//************************ Begin Local Subroutines ****************************

	//********************* Begin function make_cylind_compartment *************
	function make_cylind_compartment
		if (!{exists compartment})
			echo "COMPARTMENT DID NOT EXIST PRIOR TO CALL TO:"
			echo 			"make_cylind_compartment"
			create	compartment compartment
		end

   	addfield compartment position   // add a new field "postion" to store distance to soma
	setfield compartment 		\ 
     		Em         {ELEAK} 	\
      	    initVm     {EREST_ACT} 	\


=== Following is the header of samples/150912/EvansEtAl2013/MScell/AddCaSpines.g ===
 //function to add calcium channels to spines 

function addCaChannelspines(channelName, compPath, conductance, caBufferName)
  str channelName, compPath
  float conductance
  str caBufferName

  pushe {compPath}

    // Copy the channel from library
    copy /library/{channelName} {channelName}
    copy /library/{channelName}GHK {channelName}GHK

    // Set the new conductance
    float len = {getfield {compPath} len}
    float dia = {getfield {compPath} dia}
    float pi = 3.141592653589793
    float surf = {len*dia*pi} 

    // echo "Channel: "{channelName}", conductance "{conductance}"S/m"
    // echo "Compartment: "{compPath}", surface area "{surf}"m"
    setfield {channelName} Gbar {conductance*surf}

 	coupleCaBufferCaChannel {caBufferName} {compPath} {channelName}


    // Couple channel, its GHK object and compartment together
    addmsg {compPath} {channelName}GHK VOLTAGE Vm
    addmsg {compPath} {channelName} VOLTAGE Vm
    addmsg {channelName}GHK {compPath} CHANNEL Gk Ek
    addmsg {channelName} {channelName}GHK PERMEABILITY Gk

//     float len = {getfield {compPath} len}
//     float dia = {getfield {compPath} dia}
//     float pi = 3.141592653589793
//     float surf = {len*dia*pi}

//     // echo "conductance (unscaled): "{conductance}
//     // echo "Compartment: "{compPath}" surface area "{surf}"m"
//     setfield {channelName} Gbar {conductance*surf}


=== Following is the header of samples/150912/EvansEtAl2013/MScell/CaDifshell.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	      CaDifshell.g 	*********************
	Avrama Blackwell 	kblackw1@gmu.edu
	Wonryull Koh		wkoh1@gmu.edu
	Rebekah Evans 		rcolema2@gmu.edu
	Sriram 				dsriraman@gmail.com	
******************************************************************************

*****************************************************************************/

//***************************** Begin Local Subroutine ***********************
//old calcium concentration - single time constant of decay
function add_CaConcen (buffername, a, b, cellpath)
	str buffername,cellpath
    float a,b

    str compt
	float len,dia,position
    float Ca_tau,kb   		
	float PI = 3.14159
    float shell_thick={outershell_thickness}
    float Ca_base = {base}

	foreach compt ({el {cellpath}/##[TYPE=compartment]})
	
		//make sure this is the correct compartment type, and determine length and diameter
 		if (!{{compt} == {{cellpath}@"/axIS"} || {compt} == {{cellpath}@"/ax"}}) 
    		dia = {getfield {compt} dia}
    		position = {getfield {compt} position}
     		len = {getfield {compt} len}
    		if ({{getpath {compt} -tail} == "soma"})
              len = dia
            end
   		end

  			//if the compartment is not a spine and its position is between [a,b] 
   		if ({position >= a} && {position < b} ) 
     			// Sabatini's model. Sabatini, 2001,2004


=== Following is the header of samples/150912/EvansEtAl2013/MScell/globals.g ===
//genesis

/***************************		MS Model, Version 9.1	**********************
**************************** 	      	globals.g 			**********************

******************************************************************************/

//Careful - all of these can be overridden in the .p file
        float ELEAK = -0.06
        float PI = 3.1415926
        //float RA = 1.0 //determined by .p file (6)
        float RM = 2.8  //8.69565217  not overwritten in .p file, this is the right value
        //float CM = 0.01  //is determined in .p file (altered to compensate for lack of spines)
        float EREST_ACT = -0.085 //-85 mV
 	float TEMPERATURE = 35

//parameters determined by hand tuning to match spike width, AHP shape &amp, fI curve

float somaLen=16.1e-6 //soma only
float prox=42.1e-6 //26.1e-6 //primary and secondary
float mid=60.1e-6 //62.1e-6 //tert1 
float dist=1000e-6

	float gNaFsoma={50000}    //50000
        float gNaFprox={6000}	//includes mid
        float gNaFdist={2000}	

        float gKAfsoma={300}      
        float gKAfdend={{550}}  

        float gKAssoma={200}  
        float gKAsdend={22}  //includes mid 

        float gKIRsoma={11} //{11}        
        float gKIRdend={11}

	float gKrpsoma={14}  //10.008 is 14     
	float gKrpdend={14}
	
	float gBKsoma={10}


=== Following is the header of samples/150912/EvansEtAl2013/MScell/SynParamsCtx.g ===
//genesis
//SynParams.g

	str AMPAname = "AMPA"
	float EkAMPA = 0.0
        float AMPAtau1 = 1.1e-3   //wolf with qfact of 2 taken into account (t1 and t2)
        float AMPAtau2 = 5.75e-3  
        float AMPAgmax = 0.171e-9 //0.342e-9  25%or 50% Gsyn for shindou test//593e-12 I changed this to make the NMDA/AMPA ratio more like 2.75/1 which is what Ding 2008 finds int corticalstriatal synapses
	float AMPACaper = 0 //0.001 //percent AMPA conductance that is carried by calcium. value from wolf							//more like 2/1 for thalamus so should be 0.47e-9 for thalamo-striatal syanpnse if NMDA is 0.94e-9 Rebekah Evans 6/25/10
	float AMPAdes = 1 // 1  		//desensitization factor, (depr_per_spike field of facsynchan)
	float AMPAdestau = 100e-3 // 100e-3	// desensitixation t (how fast des recovers)


        str GABAname = "GABA"
        float GABAtau1 = 0.25e-3    // From Galarreta and Hestrin 1997 
        float GABAtau2 = 3.75e-3    //(used in Wolfs model)
        float EkGABA = -0.060  		//calculated Kerr and Plenz 2004 Erev for Cl, is -60 mV 5/2/12 RCE
        float GABAgmax = 900e-12  //was 750, Sri uses 900 //Modified Koos 2004 (Wolf uses 435e-12)

	int GABA2Spine = 0                                // = 0, No GABA; 
                                                  //   1, add GABA to spine head
                                                  //   2, add GABA to spine neck
	
	int addCa2Spine = 1		// 0, no ca channels in spine, 
					//1, yes ca channels in spine (non-synaptic)
	int ghk_yesno=1  //0 no ghk objects for NMDA, 1 add ghk to NMDA 
			 //ghk reduction factor and hoook ups to calcium shells are in Addsynapticchannels.g


setclock 0 5e-6 //was 5e-6
        // Simulation time step (Second)       
setclock 1 2e-5        //  time step for ascii output
//setclock 1 1e-4 // time step for graphic output


// parameters for NMDA subunits


// cortex
str	    subunit = "NR2A" // A= 50e-3, ctx = 112e-3 B=300e-3 taus


=== Following is the header of samples/150912/EvansEtAl2013/MScell/include_channels.g ===
//genesis
//include_channels.g v9.1
/*******
Rebekah Evans updated 3/20/12
include_channels.g is included in proto.g file
**********/

include MScell/channels/tabchanforms.g

//voltage dependent channels
include MScell/channels/NaF	
include MScell/channels/NaFslowinact		//double checked RCE 3/23/12, realized htau has qfact 2 taken into account, but not mtau. no changes made, but will test qfact
include MScell/channels/KaF  			//double checked RCE 3/21/12 fine, no changes.  triple checked with genesis _____
include MScell/channels/Kir			//double checked RCE 3/22/12 fine, no changes. triple checked with genesis ____
include MScell/channels/KaS			//double checked RCE 3/22/12 fine, no changes. triple checked with genesis _____
include MScell/channels/Krp			//adjusted 3/22/12 RCE double checked _____ triple checked with genesis _____

//calcium channels
include MScell/channels/CaL12CDI  	//adjusted 3/20/12 RCE double checked _______  triple checked with genesis _____
include MScell/channels/CaL13CDI  	//adjusted 3/20/12 RCE double checked _______ triple checked with genesis _____
include MScell/channels/CaNCDI		  //adjusted 3/20/12 RCE double checked _______ triple checked with genesis _____
include MScell/channels/CaRCDI		  //adjusted 3/20/12 RCE double checked _______ triple checked with genesis _____
include MScell/channels/CaT 	 	 //adjusted 3/20/12 RCE double checked _______ triple checked with genesis _____



//calcium dependent potassium channels
include MScell/channels/BK			//double checked RCE 3/22/12 fine, no changes made.  
include MScell/channels/SK			//double checked RCE 3/23/12 fine, no changes made.  




=== Following is the header of samples/150912/EvansEtAl2013/MScell/connectCaChannels.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	  		connectCaChannels.g		*********************

******************************************************************************
******************************************************************************/

function coupleCaPoolCaChannel(bufferName, compPath, caChannelName)

  str bufferName
  str compPath
  str caChannelName

  pushe {compPath}

  if({isa difshell {compPath}/{bufferName}})
    addmsg {caChannelName}GHK {bufferName} INFLUX Ik 
    addmsg {bufferName} {caChannelName}GHK CIN C
  elif({isa Ca_concen {compPath}/{bufferName}})
    addmsg {caChannelName}GHK {bufferName} I_Ca Ik 
    addmsg {bufferName} {caChannelName}GHK CIN Ca  
  end

  pope {compPath}

end


function addCaChannel(channelName, compPath, conductance, caBufferName)

  str channelName, compPath
  float conductance
  str caBufferName

  pushe {compPath}

    // Copy the GHK part of the channel from library
    copy /library/{channelName}GHK {channelName}GHK



=== Following is the header of samples/150912/EvansEtAl2013/MScell/US5grad.g ===

str cellpath = "/cell"

include RebekahSims/SpikeMaker.g
include RebekahSims/add_outputgrad

add_output

str stimtype = "20Hz5msAP"
diskpath={diskpath}@(stimtype)@".txt"
echo {diskpath}
setfield /output/plot_out filename output/{diskpath}
reset
call /output/plot_out OUT_OPEN
call /output/plot_out OUT_WRITE "time SomaVm tert1Vm tert5Vm tert9Vm tert13Vm tert1fura tert5fura tert9fura tert13fura tert1vol tert5vol tert9vol tert13vol" //header	



int Hz = 20 //for glu, function multiplies this by 2 for GABA
float upstate_time = 0.3
float AP_time = 0.005  //AP latency from upstate onset
float AP_durtime = 0.002 //duration of AP depolarization at soma, 5 ms
float high_time = 0.01
float med_time  = 0.2
float low_time  = 0.09

// use randomspike to put inputs into NMDA and AMPA receptors 

makeALLpre {Hz}


step 0.05 -time

makeALLpost "high"

	step {AP_time} -time

	setfield {cellpath}/soma inject {2000e-12}

	step {AP_durtime} -time


=== Following is the header of samples/150912/EvansEtAl2013/MScell/MScellshortSpines.g ===
//genesis


/***************************		MS Model, Version 8	*********************
**************************** 	      MScellqfact.g 	*********************
	Avrama Blackwell 	kblackw1@gmu.edu
	Wonryull Koh		wkoh1@gmu.edu
	Rebekah Evans 		rcolema2@gmu.edu
	Sriram 				dsriraman@gmail.com	
	Tom Sheehan 		tsheeha2@gmu.edu	
******************************************************************************

*****************************************************************************
*************************
	MS_cell.g has only one externally called function: make_MS_cell. That primary 
	function uses the services of the following two local subroutines:
		set_position
		add_channels

******************************************************************************/
include MScell/MScellshort.g                 //MScell without synapses
include MScell/SynParamsCtx.g               //parameters on synaptic channels
include MScell/channels/nmda_channel.g   //function to make nmda channel, either GHK or not, in library
include MScell/channels/synaptic_channel.g // function to make non nmda synaptic channels in library
include MScell/AddSynapticChannels.g	// contains functions to add channels to compartments
include MScell/AddCaSpines.g		//includes calcium channels 
include MScell/CaDifshellSpine.g        //new calcium dynamics (difshell objects w/buffers etc)
include MScell/spines.g           //creates spines, puts channels & calcium in spines
	
    	

function make_MS_cell_spine (cellname,pfile)
   str cellname,pfile

   str CompName

   make_MS_cell {cellname} {pfile}

	//************* create synaptic channels in library *********
	pushe /library


=== Following is the header of samples/150912/EvansEtAl2013/MScell/globals11.003.g ===
//genesis

/***************************		MS Model, Version 9.1	**********************
**************************** 	      	globals.g 			**********************

******************************************************************************/

//Careful - all of these can be overridden in the .p file
        float ELEAK = -0.06
        float PI = 3.1415926
        //float RA = 1.0 //determined by .p file (6)
        float RM = 2.8  //8.69565217  not overwritten in .p file, this is the right value
        //float CM = 0.01  //is determined in .p file (altered to compensate for lack of spines)
        float EREST_ACT = -0.085 //-85 mV
 	float TEMPERATURE = 35

//parameters determined by hand tuning to match spike width, AHP shape &amp, fI curve

float somaLen=16.1e-6
float prox=26.1e-6
float mid=60e-6
float dist=1000e-6

	float gNaFprox={50000}    
        float gNaFmid={6000}	
        float gNaFdist={1000}	

        float gKAfprox={300}      
        float gKAfmid={{550}}     
        float gKAfdist={{550}}	

        float gKAsprox={200}  
        float gKAsdist={22}  //includes mid 

        float gKIRsoma={11} //{11}        
        float gKIRdend={11}

	float gKrpsoma={14}  //10.008 is 14     
	float gKrpdend={14}
	


=== Following is the header of samples/150912/EvansEtAl2013/MScell/AddSynapticChannels.g ===
//genesis

/***************************		MS Model, Version 9.4	**********************
**************************** 	     AddSynapticChannels.g 	**********************

******************************************************************************/


function addNMDAchannel(compPath, chanpath,caBuffer, gbar, ghk)

  str compPath, chanpath
  float gbar
  str caBuffer 
  int ghk

  copy /library/{chanpath} {compPath}/{chanpath}
  addmsg {compPath} {compPath}/{chanpath}/block VOLTAGE Vm
  addmsg {compPath} {compPath}/{chanpath} VOLTAGE Vm
  addmsg {compPath}/{chanpath}/block {compPath} CHANNEL Gk Ek
  

  if (ghk==1)
    addmsg {compPath} {compPath}/{chanpath}/GHK VOLTAGE Vm
  end

  // Set the new conductance
  float len = {getfield {compPath} len}
  float dia = {getfield {compPath} dia}
  float pi = 3.141592653589793
  float surf = {len*dia*pi}

/*
    echo "XXXXXXXXXXXXXXX addNMDAchannel XXXXXXXXXXXXXXXX"
	echo "compPath = "{compPath}
	echo "chanpath = "{chanpath}
	echo "caBuffer = "{caBuffer}
	echo "gbar = "{gbar}
	echo "NMDACaGHK=" {NMDACaGHK}
	echo "XXXXXXXXXXXXXXX addNMDAchannel XXXXXXXXXXXXXXXX"
*/


=== Following is the header of samples/150912/EvansEtAl2013/MScell/addinput.g ===

//addinput.g
//these two functions used to provide random spike synaptic input to neuron

function makeinputpre(rate, path)
    str rate
	str path
    create randomspike {path}/randomspike
    setfield ^ min_amp 1.0 max_amp 1.0 rate {rate} reset 1 reset_value 0	
 end
	
function makeinputpost(pathspike, path) 
	str path
	int msgnum
	addmsg {pathspike} {path} SPIKE
    msgnum = {getfield {path} nsynapses} - 1
    setfield {path} \
    synapse[{msgnum}].weight 1 synapse[{msgnum}].delay 0
end


function stopinput(path)
str path
deletemsg {path} 2 -incoming
end




=== Following is the header of samples/150912/EvansEtAl2013/MScell/addchans.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	      addchansNew.g 	*********************
	Avrama Blackwell 	kblackw1@gmu.edu
	Wonryull Koh		wkoh1@gmu.edu
	Rebekah Evans 		rcolema2@gmu.edu
	Sriram 				dsriraman@gmail.com		
******************************************************************************/
function connectKCachannel(compPath, caBufferName, channel)
  str compPath, channel
  str caBufferName

  if({isa difshell {compPath}/{caBufferName}}) 
    addmsg {compPath}/{caBufferName} {compPath}/{channel} CONCEN C
  elif({isa Ca_concen {compPath}/{caBufferName}})
   addmsg {compPath}/{caBufferName} {compPath}/{channel} CONCEN Ca
  end
end

function AddCDI (compPath, caBufferName, channel)
  str compPath, channel
  str caBufferName

  if({isa difshell {compPath}/{caBufferName}}) 
    addmsg {compPath}/{caBufferName} {compPath}/{channel} CONCEN C
  elif({isa Ca_concen {compPath}/{caBufferName}})
   addmsg {compPath}/{caBufferName} {compPath}/{channel} CONCEN Ca
  end
end

function SumGk (compPath)  //called in MScellshort.g
	str compPath
	create diffamp {compPath}/GkSum
	setfield {compPath}/GkSum gain 1
	setfield {compPath}/GkSum saturation 100

	addmsg {compPath}/KAf_channel {compPath}/GkSum PLUS Gk
	addmsg {compPath}/KAs_channel {compPath}/GkSum PLUS Gk
	addmsg {compPath}/Krp_channel {compPath}/GkSum PLUS Gk


=== Following is the header of samples/150912/EvansEtAl2013/MScell/MScellshortthickCM3noproto.p ===
//***************************		MS Model, Version 5.0	**********************
//*************************** 	      MScell.p 			**********************
//			Tom Sheehan tsheeha2@gmu.edu	thsheeha@vt.edu	703-538-836
//*****************************************************************************

*relative
*cartesian
*asymmetric
*lambda_warn

*set_global RA 6.0 
//change Cm to account for no spines - make 3x higher?
*set_global CM 0.03  

*start_cell
*spherical
soma none 16.000 0 0 16.000

*cylindrical
primdend1 soma 12 0 0 1.7
primdend2 soma 12 0 0 1.7
primdend3 soma 12 0 0 1.7
primdend4 soma 12 0 0 1.7

secdend11 primdend1 14 0 0 1.4
secdend12 primdend1 14 0 0 1.4
secdend21 primdend2 14 0 0 1.4
secdend22 primdend2 14 0 0 1.4
secdend31 primdend3 14 0 0 1.4
secdend32 primdend3 14 0 0 1.4
secdend41 primdend4 14 0 0 1.4
secdend42 primdend4 14 0 0 1.4

tertdend1_1 secdend11 18  0  0  1.2
tertdend1_2 . 18 0 0 1.2 
tertdend1_3 . 18 0 0 1.2
tertdend1_4 . 18 0 0 1.2
tertdend1_5 . 18 0 0 1.2
tertdend1_6 . 18 0 0 1.2
tertdend1_7 . 18 0 0 1.2


=== Following is the header of samples/150912/EvansEtAl2013/MScell/MScellshort.g ===
//genesis


/***************************		MS Model, Version 8	*********************
**************************** 	      MScellqfact.g 	*********************
	Avrama Blackwell 	kblackw1@gmu.edu
	Wonryull Koh		wkoh1@gmu.edu
	Rebekah Evans 		rcolema2@gmu.edu
	Sriram 			dsriraman@gmail.com	
******************************************************************************

*****************************************************************************
*************************
	MS_cell.g has only one externally called function: make_MS_cell. That primary 
	function uses the services of the following two local subroutines:
		set_position
		add_channels

******************************************************************************/

include MScell/globals  		// Defines & initializes cell specific parameters
include MScell/Ca_constants.g
include MScell/proto  // provides access to make_prototypes (and individual channels) 
include MScell/addchans	// provides access to add_uniform_channel & add_CaShells 
include MScell/CaDifshell.g
        
    	
//************************ Begin Local Subroutines ****************************
//*****************************************************************************

	//************************ Begin function set_position *********************
	//**************************************************************************
	function set_position (cellpath)
		//********************* Begin Local Variables ************************
 		str compt, cellpath
 		float dist2soma,x,y,z
 		//********************* End Local Variables *****************************
 		
 		if (!{exists {cellpath}})
  			echo The current input {cellpath} does not exist (set_position) 


=== Following is the header of samples/150912/EvansEtAl2013/MScell/MScellSyn.g ===
//genesis
//MScellSyn.g
//This routine takes the MScell without synapses, and adds synapses

include MScell/MScellshort.g                 //MScell without synapses
include MScell/SynParamsCtx.g               //parameters on synaptic channels
include MScell/channels/nmda_channel.g   //function to make nmda channel, either GHK or not, in library
include MScell/channels/synaptic_channel.g // function to make non nmda synaptic channels in library
include MScell/AddSynapticChannels.g	// contains functions to add channels to compartments

function makeMScellSyn (cellname,pfile)
   str cellname,pfile

   str CompName

   make_MS_cell {cellname} {pfile}

	//************* create synaptic channels in library *********
	pushe /library

  	make_synaptic_channel  {AMPAname} {AMPAtau1} {AMPAtau2} {AMPAgmax} {EkAMPA} {AMPAdes} {AMPAdestau}
  	make_NMDA_channel    {NMDAname} {EkNMDA} {Kmg} {NMDAtau2} {NMDAgmax} {ghk_yesno} {NMDAdes} {NMDAdestau}
	make_synaptic_channel  {GABAname} {GABAtau1} {GABAtau2} {GABAgmax} {EkGABA} {0} {0}
        pope {cellname}
	
   //********************* end synaptic channels in library **************

      foreach CompName ({el {cellname}/##[TYPE=compartment]}) 
        addNMDAchannel {CompName} {NMDAname} {outermostshell} {NMDAgmax} {ghk_yesno}
        addSynChannel  {CompName} {AMPAname} {AMPAgmax} {outermostshell} 
        addSynChannel  {CompName} {GABAname} {GABAgmax}	{dummyshell} 
	//add_extra_pools {CompName} {NMDACaGHK}
/*
		create spikegen {CompName}/spikegen
		setfield {CompName}/spikegen thresh 10
		addmsg   {CompName}/spikegen  {CompName}/{NMDAname} SPIKE 
		addmsg   {CompName}/spikegen  {CompName}/{AMPAname} SPIKE 
		
		create neutral {CompName}/presyn_ext
		setfield {CompName}/presyn_ext z 0


=== Following is the header of samples/150912/EvansEtAl2013/MScell/spines.g ===
//spines.g for including spines in the MSN model.

//****************make the spines************************************

//for calcium and buffer diffusion messages between spine neck and dendrite.  
//this is a very unclean way to do it because these variables are defined elsewhere.
str uppershellname = {CalciumName} @ 1
str midshellname = {CalciumName} @ 2
str bottomshellname = {CalciumName} @ 3
str outermostShellName = {CalciumName} @ 1

function make_spines

float surf_neck, vol_neck, len_neck, dia_neck,dia_head,len_head,dia_head, surf_head,vol_head, shell_thick, dia_shell, shell_head, Ca_tau, kB, kE,r,Ca_base  

// parameters:
       // for spine neck:
       len_neck=1e-6                               //0.16-2.13
       dia_neck=0.1e-6                             //(0.038-0.46)e-6
       // for spine head:
       dia_head=0.5e-6                              //adopt common size, no exact data are available now
       len_head=0.5e-6
       surf_head=dia_head*len_head*{PI}
       surf_neck=len_neck*dia_neck*{PI}
      

 // for calcium constants using concen objects:
    if ({shellMode}==1)
		kE =86.0                                   // Cater and Sabatini, 2004
        Ca_tau = 25.0e-3                            
        r= (1+kE)/Ca_tau
        Ca_base = 50e-6                            // baseline: 50 nM
     end

//  vol_neck={len_neck*dia_neck*dia_neck*PI/4.0}
  if (!{exists spine})
     create compartment spine
  end

 addfield  spine position


=== Following is the header of samples/150912/EvansEtAl2013/MScell/cntrlglobals.g ===
//genesis

/***************************		MS Model, Version 9.1	**********************
**************************** 	      	globals.g 			**********************

******************************************************************************/

//Careful - all of these can be overridden in the .p file
        float ELEAK = -0.06
        float PI = 3.1415926
        float RA = 1.0 //determined by .p file (6)
        float RM = 2.8  //8.69565217  not overwritten in .p file, this is the right value
        float CM = 0.01  //is determined in .p file (altered to compensate for lack of spines)
        float EREST_ACT = -0.085 //-85 mV
 	float TEMPERATURE = 35

//parameters determined by hand tuning to match spike width, AHP shape &amp, fI curve

float somaLen=16.1e-6
float prox=26.1e-6
float mid=60e-6
float dist=1000e-6

        float gNaFprox={45000}  //  only in soma   
        float gNaFmid={6000}	// in prox and mid dends
        float gNaFdist={1000}	

        float gKAfprox={385}      
        float gKAfmid={{550}}     
        float gKAfdist={{550}}	

        float gKAsprox={200}  	 
        float gKAsdist={22}  //includes mid 

        float gKIR={11} //{11}        
        float gKrp={14}  //10.008 is 14     
		
	float gBK={10}
	float gSK={1}



=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/NaF.g ===
//genesis

/***************************MS Model, Version 9.1	*********************
****************************   NaF.g 	*********************
updated Rebekah Evans 3/22/12					
******************************************************************************
******************************************************************************/

//**ref: Nobukuni Ogata, et.al. 1990


function make_NaF_channel
float Erev       = 0.05      // V

    
    str path = "NaF_channel" 

    float xmin  = -0.10  /* minimum voltage we will see in the simulation */     // V
    float xmax  = 0.05  /* maximum voltage we will see in the simulation */      // V
    int xdivsFiner = 3000
    int c = 0
   float increment = (xmax - xmin)*1e3/xdivsFiner  // mV


//Inactivation constants for alphas and betas
//units are mV, ms
	
	//mtau fits ogata figure 5 perfectly, but no qfactor is applied.  
    float mtau_min=0.1
	float mtau_rate = 1.45
	float mtau_slope = 8
    float mtau_vhalf=-62
	
	
	//activation minf fits Ogata 1990 figure 3C (which is cubed root) 
	float mss_rate = 1
	float mss_vhalf = -25
	float mss_slope = -10

	//htau fits the main -50 through -10 slope of Ogata figure 9 (log tau), but a qfact of 2 is already taken into account.  


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/gaba_channel.g ===
//genesis
//gaba_channel.g

function make_GABA_channel

   str chanpath = "GABA_channel"
   // From Galarreta and Hestrin 1997 (used in Wolfs model)
   float tau1 = 0.25e-3
   float tau2 = 3.75e-3

   float gmax = 750e-12  //Modified Koos 2004 (Wolf uses 435e-12)
   float Ek = -0.060

	echo "XXXXXXXXXXXXXXX make_GABA_channel XXXXXXXXXXXXXXXX"
	echo "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
	echo "XXXXXXXXXXXXXXX make_GABA_channel XXXXXXXXXXXXXXXX"

   create synchan {chanpath}

   setfield {chanpath} tau1 {tau1} \
                       tau2 {tau2}\ 
                       gmax {gmax}\
                        Ek {Ek}

end




=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/Kir.g ===
//genesis
/***************************		MS Model, Version 9.1 *********************
**************************** 	    	Kirg 			*********************
						Rebekah Evans updated 3/22/12 
******************************************************************************
******************************************************************************/


function make_KIR_channel

 //initial parameters for making tab channel
	float Erev = -0.09
	int m_power = 1
    int h_power = 0
    
//units are mV, ms
	float mA_rate = 1e-5
	float mA_slope = -11
	
	float mB_rate = 1.2
	float mB_vhalf = 30
	float mB_slope = -50

	str path = "KIR_channel" 

    float xmin  = -0.15  /* minimum voltage we will see in the simulation */     // V
    float xmax  = 0.05  /* maximum voltage we will see in the simulation */      // V
    int xdivsFiner = 4000
    int c = 0

   float increment = (xmax - xmin)*1e3/xdivsFiner  // mV
   
   float x = -150.00 
  
    	  
    create tabchannel {path} 
    call {path} TABCREATE X {xdivsFiner} {xmin} {xmax}  // activation   gate

    /* Defines the powers of m Hodgkin-Huxley equation*/
    setfield {path} Ek {Erev} Xpower {m_power} Ypower {h_power}


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/KaF.g ===
//genesis

/***************************		MS Model, Version 9.1 *********************
**************************** 	    	KaF.g 			*********************
						Rebekah Evans updated 3/21/12 
	Kv4.2
******************************************************************************
******************************************************************************/

function make_KAf_channel

  //initial parameters for making tab channel
	float Erev = -0.09
	int m_power = 2   //used in Wolf 2005
    int h_power = 1
	
//Activation constants for alphas and betas (obtained by matching m2 to Tkatch et al., 2000 Figs 2c, and mtau to fig 2b)
//units are mV, ms
	float mA_rate = 1.8  
	float mA_vhalf = -18    
	float mA_slope = -13   
	
	float mB_rate = 0.45  
	float mB_vhalf = 2   
	float mB_slope = 11  
	
//Inactivation constants for alphas and betas obtained by matching Tkatch et al., 2000 Fig 3b, and creating a tau voltage dependence 
//which is consistent with their value for V=0 in figure 3c.  
//units are mV, ms
	float hA_rate = 0.105
	float hA_vhalf = -121
	float hA_slope = 22
	
	float hB_rate = 0.065
	float hB_vhalf = -55
	float hB_slope = -11
	    
	//table filling parameters	
    float xmin  = -0.1  
    float xmax  = 0.05  


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/CaR.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	  		CaR.g 			*********************
	Rebekah Evans 3/20/12 updated channel. 
******************************************************************************
******************************************************************************/

function create_CaR
	str chanName = "CaR_channel"
	str compPath = "/library"

	int c = 0	

	int xdivs = 3000
	float Ek = 0.140  //(nernst calculated for 35degrees, [Cain] 50nM [Caout]2mM)
			//Ek is overwritten the the GHK object if it is used. 
	float x = -0.1
	float xmin = -0.1
	float xmax = 0.05
        float increment ={{xmax}-{xmin}}/{xdivs}
        echo "CaR increment:" {increment} "V"
  	float mPower = 3.0  //Foerhing et al., 2000 p 2228
  	float hPower = 1.0

	float mvHalfCaR = -29e-3  
	float mkCaR     = -9.6e-3
	float hvHalfCaR = -33.3e-3
	float hkCaR     = 17e-3

	float mTauCaR = 5.1e-003  //Foehring et al., 2000 pg 2230.
	float mInfCaR = 0.0
	float hTauCaR = 0.0
	float hInfCaR = 0.0
	float hA 
	float hB

	float qFactCaR = {qfactCa}

	float surf = 0.0


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/tabchanforms.g ===
/*form call file for creating tab channels*/


function exp_form (rate, slope, V)
	float rate,slope,V
	//equation is ({rate} *(exp ({-V}/{slope}) ))
	float numx ={{-V}/{slope}}
	float expx = {exp {numx}}
	float entry = ({rate}*{expx})
	return {entry}
end

function sig_form (rate, vhalf, slope, V)
	float rate, vhalf, slope, V
	//equation is ({rate}/(exp ({{V}-{vhalf}}/{slope})+1))
	//rate/(EXP((v-vhalf)/slope)+1)
	float numx = {{{V}-{vhalf}}/{slope}}
	float expx = {exp {numx}}
	float entry = ({rate}/{{expx}+1})
	return {entry}
end

function lin_form (rate, vhalf, slope, V)

	float rate, vhalf, slope, V
	//equation is (({rate}*({V}-{vhalf}))/{exp ({v}-{vhalf}/{slope})-1)})
	float expx = {exp {{{V}-{vhalf}}/{slope}}} -1
	float numerator = {{rate}*{{V}-{vhalf}}}
	float entry = {{numerator}/{expx}}
	return {entry}
	// put in check for if v=vhalf then add 0.0001 or something. or... dtop/dbottom is L'Hopital.  
	
end


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/KaS.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	    	KaS.g 			*********************
	Rebekah Evans update 3/22/12
	Kv1.2
******************************************************************************
*****************************************************************************/


function make_KAs_channel
   //include tabchanforms
  //initial parameters for making tab channel
	float Erev = -0.09
	int m_power = 2  //shen et al., 2004 p 1341
   int h_power = 1
	
//Activation constants for alphas and betas Shen et al., 2004 fig 3B (minf^2) and 3D (mtau)
	float mA_rate = 0.25 
	float mA_vhalf = 54   
	float mA_slope = -22  
	
	float mB_rate = 0.05 
	float mB_vhalf = -100  
	float mB_slope = 35
		
//Inactivation constants for alphas and betas tuned to fit Shen et al., 2004 fig 6B (Inact) hinf and htau.  
	float hA_rate = 2.5 
	float hA_vhalf = -95
	float hA_slope = 16
	
	float hB_rate = 2 
	float hB_vhalf = 50
	float hB_slope = -70
	    
	//table filling parameters	
    float xmin  = -0.1  /* minimum voltage we will see in the simulation */ 
    float xmax  = 0.05  /* maximum voltage we will see in the simulation */ 
    int  xdivsFiner = 3000 /* the number of divisions between -0.1 and 0.05 */
    int c = 0


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/nmda_channel.g ===
//genesis
//nmda_channel.g

function make_NMDA_channel (chanpath, Ek, KMg, tau2, gmax, ghk, depr, deprtau)

  str chanpath //what you want the channel to be called (full path)
  float KMg, tau2, gmax  //parameters that differ between NR2A, B, C and D subunits
  float depr
  float deprtau
  float Ek
  int ghk 
  
  float tau1 =  (4.4624e-3)/2 //(5.63e-3)/8 //(4.4624e-3)/2 //  DE Chapman et al 2003, table 1 (5.63ms: wolf) w/qfact of 2 
			     //is (4.4624e-3)/2 in Evans et al., 2012
  float CMg = 1.4  // [Mg] in mM //Kerr and Plenz uses 1.4mM Mg

  float eta = 1/18  // Kmg = 1/eta, (per mM) overwritten by synparams, 3.57 old, 18 new
  float gamma = 99  //99 new //62 old  // per Volt

	echo "XXXXXXXXXXXXXXX make_NMDA_channel XXXXXXXXXXXXXXXX"
	echo "chanpath = "{chanpath}
	echo "caBuffer = "{Ek}
	echo "KMg = "{KMg}
	echo "tau2 = "{tau2}
	echo "gmax = "{gmax}
	echo "XXXXXXXXXXXXXXX make_NMDA_channel XXXXXXXXXXXXXXXX"

	create facsynchan {chanpath}
	setfield {chanpath} \
          Ek   {Ek}   \
          tau1 {tau1} \
          tau2 {tau2} \
          gmax {gmax}  \
	  depr_per_spike {depr}\
	  depr_tau {deprtau}				//why was this gmax/2?? changed back 4/15/12 RCE is overwritten by addNMDAchannel function, so I don't think it matters.
   
//the kinetics of the magnesium block is different for different subunits.  
// NR2A and B are about the same, but C and D are much less affected by the block.  
//these numbers were used because the made the magnesium block curve fit the figures by Moyner et al (1994 figure 7) best by eye.



=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/CaNCDI.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	  		CaN.g 			*********************
Rebekah Evans updated 3/20/12
******************************************************************************
******************************************************************************/

function create_CaN
	str chanName = "CaN_channel"
	str compPath = "/library"

	int c	
	float Ek = 0.140 //(nernst calculated for 35degrees, [Cain] 50nM [Caout]2mM)
			//Ek is overwritten the the GHK object if it is used. 
	float x = -0.1
	int xdivs = 3000
	float xmin = -0.1
	float xmax = 0.05
        float increment ={{xmax}-{xmin}}/{xdivs}
        echo "CaN increment:" {increment} "V"
  	float mPower = 2.0  // Kasai 1992 p169
  	float hPower = 1.0
	if (calciuminact == 1)
		float zpower = 1.0
	else
		float zpower = 0
	end	

	float mvHalfCaN = -3e-3
	float mkCaN = -8e-3
	float hvHalfCaN = -74.8e-3
	float hkCaN = 6.5e-3
	float mTauCaN = 0.0
	float mInfCaN = 0.0
	float hTauCaN = 70e-3
	float hInfCaN = 0.0
	//parameters for calcium-dep inactivation (CDI) 
	
	float Ca = 0.0


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/SK.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	      SK.g 	*********************

******************************************************************************

*****************************************************************************/

		// This is a simplified implementation of the SK channel without voltage
		// dependence. Reference: MaylieBondHersonLeeAdelman2004
		// Fast component has tau=4 ms, slow tau = 70 ms (rough ranges)


function make_SK_channel

  	int nStep = 3000
  	float SKact = 0.0
  	float CaMax = 0.1 // 100 uM
	float CaMax = 0.006 // 6 uM 
	float CaMin = 1e-6 //1 nM
	float CaMin = 0 
  	float delta = (CaMax - CaMin)/nStep  
echo "delta=", {delta}
	float theta = 0.0
	float theta_pow = 0.0	
 	float Kd = 0.57e-003

	int i
   	float Ca = 0.0
    		
  	str chanpath = "SK_channel" 
  	
  	pushe /library

  	if (({exists {chanpath}}))
    	return
  	end

  	create  tabchannel {chanpath}


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/synaptic_channel.g ===
//genesis
//synaptic_channel.g

function make_synaptic_channel (chanpath, tau1, tau2, gmax, Ek, depr, deprtau)
   str chanpath
   float tau1
   float tau2
   float gmax 
   float Ek
   float depr
   float deprtau


/*	echo "XXXXXXXXXXXXXXX make_synaptic_channel XXXXXXXXXXXXXXXX"
	echo "chanpath = "{chanpath}
	echo "tau1 = "{tau1}
	echo "tau2 = "{tau2}
	echo "gmax = "{gmax}
	echo "XXXXXXXXXXXXXXX make_synaptic_channel XXXXXXXXXXXXXXXX"
*/
   create facsynchan {chanpath}

   setfield {chanpath} tau1 {tau1} \
                       tau2 {tau2}\ 
                       gmax {gmax}\
                        Ek {Ek} \
			depr_per_spike {depr}\
			depr_tau {deprtau}

end



=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/CaN.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	  		CaN.g 			*********************
Rebekah Evans updated 3/20/12
******************************************************************************
******************************************************************************/

function create_CaN
	str chanName = "CaN_channel"
	str compPath = "/library"

	int c	
	float Ek = 0.140 //(nernst calculated for 35degrees, [Cain] 50nM [Caout]2mM)
			//Ek is overwritten the the GHK object if it is used. 
	float x = -0.1
	int xdivs = 3000
	float xmin = -0.1
	float xmax = 0.05
        float increment ={{xmax}-{xmin}}/{xdivs}
        echo "CaN increment:" {increment} "V"
  	float mPower = 2.0  // Kasai 1992 p169
  	float hPower = 1.0

	float mvHalfCaN = -3e-3
	float mkCaN = -8e-3
	float hvHalfCaN = -74.8e-3
	float hkCaN = 6.5e-3
	float mTauCaN = 0.0
	float mInfCaN = 0.0
	float hTauCaN = 70e-3
	float hInfCaN = 0.0

	float theta	= 0.0
	float theta_1 = 0.0
	float beta	= 0.0
	float beta_exp	= 0.0
	float mA	= 0.0
	float mB	= 0.0
	float surf = 0.0


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/Krp.g ===
//genesis


/***************************		MS Model, Version 9.1	*********************
**************************** 	      Krp.g 	*********************
Rebekah Evans updated 3/22/12
*****************************************************************************/

function make_Krp_channel
	
	float Erev = -0.09
	int m_power = 2 //(Nisenbaum 1996 p 1187)
	int h_power = 1
	
	//table filling parameters	
    float xmin  = -0.1  
    float xmax  = 0.05  
    int  xdivsFiner = 3000
    int c = 0
    float increment =1000*{{xmax}-{xmin}}/{xdivsFiner}
    float x = -100
 


   str path = "Krp_channel" 
    create tabchannel {path} 
    call {path} TABCREATE X {xdivsFiner} {xmin} {xmax} 
	call {path} TABCREATE Y {xdivsFiner} {xmin} {xmax} 
	
//units are mV, ms
//m parameters tuned to fit Nisenbaum 1996 fig6C (minf^2) and fig 8C (mtau)
	float mA_rate = 16
	float mA_slope = 24
	
	float mB_rate = 2.4
	float mB_slope = -45

//h parameters tuned to fit Nisenbaum 1996 fig 9D (hinf, 87% inactivating) and 9B (htau)	
	float hA_rate = 0.01
	float hA_slope = -100


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/ampa_channel.g ===
//genesis
//ampa_channel.g

function make_AMPA_channel(chanpath)
   str chanpath

   // Values from Wolfs model, original data Gotz et al 1997 (from NA),
   // Chapman et al 2003
  //float tau1 = 1.1e-3
  // float tau2 = 5.75e-3 

   //float gmax = 593e-12 these are all set in synparams.g
   float Ek = 0.0

	echo "XXXXXXXXXXXXXXX make_AMPA_channel XXXXXXXXXXXXXXXX"
	echo "chanpath = "{chanpath}
	echo "XXXXXXXXXXXXXXX make_AMPA_channel XXXXXXXXXXXXXXXX"

   create facsynchan {chanpath}

   setfield {chanpath} tau1 {tau1} tau2 {tau2} gmax {gmax} Ek {Ek} depr_per_spike {1} dep_tau {10e-3}

end


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/NaFslowinact.g ===
//genesis

/***************************MS Model, Version 9.1	*********************
****************************   NaF.g 	*********************
updated Rebekah Evans 3/22/12					
******************************************************************************
******************************************************************************/

//**ref: Nobukuni Ogata, et.al. 1990


function make_NaFd_channel
float Erev       = 0.05      // V

    
    str path = "NaFd_channel" 

    float xmin  = -0.10  /* minimum voltage we will see in the simulation */     // V
    float xmax  = 0.05  /* maximum voltage we will see in the simulation */      // V
    int xdivsFiner = 3000
    int c = 0
   float increment = (xmax - xmin)*1e3/xdivsFiner  // mV


//Inactivation constants for alphas and betas
//units are mV, ms
	
	//mtau fits ogata figure 5 perfectly, but no qfactor is applied.  
    float mtau_min=0.1
	float mtau_rate = 1.45
	float mtau_slope = 8
    float mtau_vhalf=-62
	
	
	//activation minf fits Ogata 1990 figure 3C (which is cubed root) 
	float mss_rate = 1
	float mss_vhalf = -25
	float mss_slope = -10

	//htau fits the main -50 through -10 slope of Ogata figure 9 (log tau), but a qfact of 2 is already taken into account.  


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/CaL13CDI.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	    	CaL13channel.g 		*********************
Rebekah Evans updated 3/20/12	
******************************************************************************
******************************************************************************/


function create_CaL13
	str chanName = "CaL13_channel"
	str compPath = "/library"
	int c, a
	float Ek = 0.140  //(nernst calculated for 35degrees, [Cain] 50nM [Caout]2mM)
			//Ek is overwritten the the GHK object if it is used. 
	float xmin = -0.1
	float xmax = 0.05
	int 	xdivs = 3000
	float mPower = 1.0   //mh is an equally common form to m2h (tuckwell 2012)
	float hPower = 1.0
	if (calciuminact == 1)
		float zpower = 1.0
	else
		float zpower = 0
	end	
	
        float increment ={{xmax}-{xmin}}/{xdivs}
        echo "CaL13 increment:" {increment} "V"
	float x = -0.1
  	float surf = 0
 	float gMax = 0

	float hTauCaL13 	= 44.3e-3
	float mTauCaL13 	= 0.0
	float mvHalfCaL13 = -40.0e-3
	float mkCaL13     = -5e-3
	float hvHalfCaL13 = -37e-3
	float hkCaL13     = 5e-3
	float hInfCaL13	= 0.0
	float mInfCaL13	= 0.0


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/KaFnew.g ===
//genesis

/***************************		MS Model, Version 9.1 *********************
**************************** 	    	KaF.g 			*********************
						Rebekah Evans updated 3/21/12 
	Kv4.2
******************************************************************************
******************************************************************************/

function make_KAf_channel

  //initial parameters for making tab channel
	float Erev = -0.09
	int m_power = 2   //used in Wolf 2005
    int h_power = 1
	
//Activation constants for alphas and betas (obtained by matching m2 to Tkatch et al., 2000 Figs 2c, and mtau to fig 2b)
//units are mV, ms
//new channel params 07/11/12
	float mA_rate = 1.5  
	float mA_vhalf = -16   
	float mA_slope = -14   
	
	float mB_rate = 0.45  
	float mB_vhalf = 2   
	float mB_slope = 11  
	
//Inactivation constants for alphas and betas obtained by matching Tkatch et al., 2000 Fig 3b, and creating a tau voltage dependence 
//which is consistent with their value for V=0 in figure 3c.  
//units are mV, ms

	float hA_rate = 0.15
	float hA_vhalf = -135
	float hA_slope = 21
	
	float hB_rate = 0.06
	float hB_vhalf = -40
	float hB_slope = -18
	    
	//table filling parameters	


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/CaT.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	  		CaT.g 			*********************
	
******************************************************************************
Rebekah Evans updated 3/20/12 
******************************************************************************/

function create_CaT
	str chanName = "CaT_channel"
	str compPath = "/library"

	int c = 0	
	float Ek = 0.140 //(nernst calculated for 35degrees, [Cain] 50nM [Caout]2mM)
			//Ek is overwritten the the GHK object if it is used. 
	float increment = 0.00005	
	float x = -0.1
	int xdivs = 3000
	float xmin = -0.1
	float xmax = 0.05
        float increment ={{xmax}-{xmin}}/{xdivs}
        echo "CaT increment:" {increment} "V"
  	float mPower = 3.0  //Cain 2010 review Crunelli 2005
  	float hPower = 1.0		

  	float mInfCaT = 0.0
	float mvHalfCaT = -72e-3 
  	float mkCaT     = -8e-3 
	float mshift = 0.009   //0 for a1i; 0.009 for a1g; 0.019 for a1h

  	float hvHalfCaT = -93e-3 
  	float hkCaT     = 5e-3 
  	float hInfCaT = 0.0
	float hshift = 0.007   //0 for a1i; 0.007 for a1g; 0.02 for a1h


  	float mTauCaT = 0.0
  	float mInfCaT = 0.0
  	float hTauCaT = 0.0


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/BK.g ===
//genesis


/***************************		MS Model, Version 9.1	*********************
**************************** 	      BK.g 	*********************
Rebekah Evans updated 3/22/12
******************************************************************************

*****************************************************************************/

function make_BK_channel
    float EK=-0.09  
    float K1=0.003
    float K4=0.009
  
  
	//tuned to fit Berkefeld et al., 2006 fig 3C for 10uM Ca, with positive shift for 1uM Ca and negative shift for 100uM Ca. 
    int xdivs = 299
    int ydivs = {xdivs}
    float xmin, xmax, ymin, ymax
    xmin = -0.1; xmax = 0.05; ymin = 0.0; ymax = 0.005 // x = Vm, y = [Ca],mM
    int i, j
    float x, dx, y, dy, a, b
    float Temp = 35
    float ZFbyRT = 23210/(273.15 + Temp)
    if (!({exists BK_channel}))
        create tab2Dchannel BK_channel
        setfield BK_channel Ek {EK} Gbar 0.0  \
            Xindex {VOLT_C1_INDEX} Xpower 1 Ypower 0 Zpower 0
        call BK_channel TABCREATE X {xdivs} {xmin} {xmax} \
            {ydivs} {ymin} {ymax}
    end
    dx = (xmax - xmin)/xdivs
    dy = (ymax - ymin)/ydivs
    x = xmin
    for (i = 0; i <= xdivs; i = i + 1)
        y = ymin
        for (j = 0; j <= ydivs; j = j + 1)
            a = 480*y/(y + {K1}*{exp {-0.84*ZFbyRT*x}}) 
            b = 280/(1 + y/({K4}*{exp {-1.00*ZFbyRT*x}}))


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/CaRCDI.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	  		CaR.g 			*********************
	Rebekah Evans 3/20/12 updated channel. 
******************************************************************************
******************************************************************************/

function create_CaR
	str chanName = "CaR_channel"
	str compPath = "/library"

	int c = 0	

	int xdivs = 3000
	float Ek = 0.140  //(nernst calculated for 35degrees, [Cain] 50nM [Caout]2mM)
			//Ek is overwritten the the GHK object if it is used. 
	float x = -0.1
	float xmin = -0.1
	float xmax = 0.05
        float increment ={{xmax}-{xmin}}/{xdivs}
        echo "CaR increment:" {increment} "V"
  	float mPower = 3.0  //Foerhing et al., 2000 p 2228
  	float hPower = 1.0
	if (calciuminact == 1)
		float zpower = 1.0
	else
		float zpower = 0
	end

	float mvHalfCaR = -29e-3  
	float mkCaR     = -9.6e-3
	float hvHalfCaR = -33.3e-3
	float hkCaR     = 17e-3

	float mTauCaR = 5.1e-003  //Foehring et al., 2000 pg 2230.
	float mInfCaR = 0.0
	float hTauCaR = 0.0
	float hInfCaR = 0.0
	float hA 


=== Following is the header of samples/150912/EvansEtAl2013/MScell/channels/CaL12CDI.g ===
//genesis

/***************************		MS Model, Version 9.1	*********************
**************************** 	    	CaL12channel.g 		*********************
Rebekah Evans updated 3/20/12
******************************************************************************
******************************************************************************/


function create_CaL12
	str chanName = "CaL12_channel"
	str compPath = "/library" //"/soma" for simvclamp, "/library" for normal sims
	int c
	float Ek = 0.140  //(nernst calculated for 35degrees, [Cain] 50nM [Caout]2mM)
			//Ek is overwritten the the GHK object if it is used. 
	float xmin = -0.1
	float xmax = 0.05
	int 	xdivs = 3000
	float mPower = 1.0  //mh is an equally common form to m2h (tuckwell 2012)
	float hPower = 1.0
	if (calciuminact == 1)
		float zpower = 1.0
	else
		float zpower = 0
	end	

	
        float increment ={{xmax}-{xmin}}/{xdivs}
        echo "CaL12 increment:" {increment} "V"
	float x = -0.1
  	float surf = 0
 	float gMax = 0

	float hTauCaL12 	= 44.3e-3
	float mTauCaL12 	= 0.0
	float mvHalfCaL12 = -8.9e-3
	float mkCaL12     = -6.7e-3
	float hvHalfCaL12 = -55e-3
	float hkCaL12     = 8e-3
	float hInfCaL12	= 0.0


=== Following is the header of samples/150912/EvansEtAl2013/MScell/Ca_constants.g ===
//genesis

/***************************		MS Model, Version 9	*********************
**************************** 	      Ca_constants.g 	*********************
	Avrama Blackwell 	kblackw1@gmu.edu
	Wonryull Koh		wkoh1@gmu.edu
	Rebekah Evans 		rcolema2@gmu.edu
	Sriram 			dsriraman@gmail.com	
******************************************************************************

*****************************************************************************/
    str  CalciumName = "Ca_difshell_"
    str  CA_BUFF_1 = "Ca_difshell_1"     // L and T type channels
    str  CA_BUFF_2 = "Ca_difshell_2"     // coupled to the other channels (N and R)
    str  CA_BUFF_3 = "Ca_difshell_3"     // all calcium channels
  
	int calciumdye = 0  //  flags for calcium dye. "0" means NO calcium dyes.
                     // 1= Fura-2 (default conc 100 uM, can change below)
                     // 2= Fluo-5F (300uM for Shindou, 100uM for Sabatini (check) and Lovinger)
	int calciumtype = 0     // we  have two shell-modes:
                     //  mode = 0 : detailed multi-shell model, using "difshell" object
                     //  mode = 1 : simple calcium pool adopted from  Sabatini's work(Sabatini, 2001, 2004)
	int calciuminact = 0 //calcium dependent inactivation of calcium channels, CaL1.2 and 1.3
		//0 = no CDI
		//1 = CDI for 1.3 and 1.2 N and R
	float cdiqfact = 1
	int NMDABufferMode = 0       // 1, connect both NMDA and AMPA calcium to NMDA_buffer
                                     // 0, connect only NMDA currents to NMDA_buffer


float base = 50e-6 //50nM

float outershell_thickness = 0.1e-6 //outermostshell thickness
float thicknessincrease=2 //perhaps only 1.5		

float dca = 200.0e-12 //200 (um^2)(s^(-1))
//dca = 0.1*dca

//buffer variables [Kim et al 2010 (J Neurosci)]
str bname1 = "calbindin"


=== Following is the header of samples/150912/EvansEtAl2013/MSsimSyn3.g ===
                       //genesis
// MSsim.g 

/***************************		MS Model, Version 9.1	***************
*******************************************************************************
****************************** Begin includes *******************************/

str neuronname = "/cell"
str cellpath = "/cell"

str pfile="MScell/MScelltapershortCM3noproto.p"
include MScell/MScellSyn	//access make_MS_cell this function is only called from MSsim.g
include graphics7		        //access functions make_control & make_graph
include RebekahSims/Store_Parameters.g
include RebekahSims/SpikeMakerGrad.g
include RebekahSims/SpikeMakerFlat.g
include RebekahSims/add_outputBuffers.g	

		     
// These two functions are only called from MSsimSyn.g
/****************************** End includes *********************************/
float outputclock=2e-5

	setclock 0 5e-6   // Simulation time step (Second)       
	setclock 1 {outputclock}

	makeMScellSyn {neuronname} {pfile}	// MS_cell.g

	reset

/* these graphics no longer work because of some globals and cell names
 * need to edit to pass in neuronname, etc. But, would be better to write to file. */
//	make_control		// graphics.g


//	 make_graph {neuronname}		// graphics.g
		
/*uncomment the following lines (and one line in MScell.g) to use the hsolver
        setfield  {neuronname}  chanmode 1 
        call {neuronname} SETUP


=== Following is the header of samples/150912/EvansEtAl2013/MSsimSyn7.g ===
                       //genesis
// MSsim.g 

/***************************		MS Model, Version 9.1	***************
*******************************************************************************
****************************** Begin includes *******************************/

str 	neuronname = "/cell"
str pfile="MScell/MScelltapershortCM3noproto.p"
include MScell/MScellSyn	// access make_MS_cell this function is only called from MSsim.g
include graphics7		        // access functions make_control & make_graph
include RebekahSims/Store_Parameters.g
			     
// These two functions are only called from MSsimSyn.g
/****************************** End includes *********************************/
float outputclock=2e-5

	setclock 0 5e-6   // Simulation time step (Second)       
	setclock 1 {outputclock}

	makeMScellSyn {neuronname} {pfile}	// MS_cell.g

	reset

/* these graphics no longer work because of some globals and cell names
 * need to edit to pass in neuronname, etc. But, would be better to write to file. */
//	make_control		// graphics.g


//	 make_graph {neuronname}		// graphics.g
		
/*uncomment the following lines (and one line in MScell.g) to use the hsolver
        setfield  {neuronname}  chanmode 1 
        call {neuronname} SETUP
        setmethod 11
*/	
	reset

/****************************** End MSsimSyn.g **********************************/
str diskpath1="Syn7NaFdR34"  


